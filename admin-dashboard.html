<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="Admin Dashboard - Manage orders and products"
        />
        <title>Admin Dashboard - MoonCart</title>

        <!-- Favicon -->
        <!-- <link rel="icon" type="image/svg+xml" href="assets/images/favicon.svg" /> -->

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
            rel="stylesheet"
        />

        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />

        <!-- Stylesheets -->
        <link rel="stylesheet" href="css/main.css" />
        <link rel="stylesheet" href="css/responsive.css" />

        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    </head>
    <body>
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="container">
                <div class="top-bar-content">
                    <div class="top-bar-left">
                        <span
                            ><i class="fas fa-phone-alt"></i> +1 234 567
                            8900</span
                        >
                        <span
                            ><i class="fas fa-envelope"></i>
                            info@mooncart.com</span
                        >
                    </div>
                    <div class="top-bar-right">
                        <span class="delivery-badge"
                            ><i class="fas fa-shield-alt"></i> Admin
                            Dashboard</span
                        >
                        <div class="social-icons">
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="header">
            <div class="container">
                <nav class="navbar">
                    <a href="index.html" class="logo">
                        <div class="logo-icon">
                            <i class="fas fa-moon"></i>
                        </div>
                        <div class="logo-text">
                            <span class="logo-main"
                                >Moon<span class="logo-accent">Cart</span></span
                            >
                            <span class="logo-tagline">Fresh & Fast</span>
                        </div>
                    </a>

                    <ul class="nav-menu">
                        <li>
                            <a
                                href="admin-dashboard.html"
                                class="nav-link active"
                            >
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="admin-products.html" class="nav-link">
                                <i class="fas fa-box"></i>
                                <span>Products</span>
                            </a>
                        </li>
                        <li>
                            <a href="admin-orders.html" class="nav-link">
                                <i class="fas fa-shopping-bag"></i>
                                <span>Orders</span>
                            </a>
                        </li>
                        <li>
                            <a href="admin-delivery.html" class="nav-link">
                                <i class="fas fa-truck"></i>
                                <span>Delivery</span>
                            </a>
                        </li>
                        <li>
                            <a
                                href="#product-requests"
                                class="nav-link"
                                onclick="showSection('product-requests', this)"
                            >
                                <i class="fas fa-comments"></i>
                                <span>Product Requests</span>
                            </a>
                        </li>
                    </ul>

                    <div class="nav-actions">
                        <!-- Account Section (Dynamic) -->
                        <div id="account-section" class="account-section">
                            <div class="auth-buttons">
                                <a href="login.html" class="btn-login">
                                    <i class="fas fa-sign-in-alt"></i>
                                    <span>Login</span>
                                </a>
                                <a href="signup.html" class="btn-signup">
                                    <i class="fas fa-user-plus"></i>
                                    <span>Sign Up</span>
                                </a>
                            </div>
                        </div>

                        <div class="menu-toggle">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Dashboard -->
        <div class="dashboard">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-menu">
                    <a
                        href="#overview"
                        class="sidebar-link active"
                        onclick="showSection('overview', this)"
                    >
                        <i class="fas fa-chart-line"></i> Overview
                    </a>
                    <a
                        href="#customers"
                        class="sidebar-link"
                        onclick="showSection('customers', this)"
                    >
                        <i class="fas fa-users"></i> Customers
                    </a>
                    <a
                        href="#delivery"
                        class="sidebar-link"
                        onclick="showSection('delivery', this)"
                    >
                        <i class="fas fa-truck"></i> Delivery Man
                    </a>
                    <a
                        href="#product-requests"
                        class="sidebar-link"
                        onclick="showSection('product-requests', this)"
                    >
                        <i class="fas fa-comments"></i> Product Requests
                    </a>
                    <a
                        href="#settings"
                        class="sidebar-link"
                        onclick="showSection('settings', this)"
                    >
                        <i class="fas fa-cog"></i> Settings
                    </a>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="dashboard-content">
                <!-- Overview Section -->
                <section id="overview-section" class="dashboard-section">
                    <div style="margin-bottom: 30px">
                        <h2
                            style="
                                font-size: 28px;
                                font-weight: 700;
                                color: var(--text-dark);
                                margin-bottom: 10px;
                            "
                        >
                            <i
                                class="fas fa-chart-line"
                                style="
                                    color: var(--primary-color);
                                    margin-right: 10px;
                                "
                            ></i>
                            Overview
                        </h2>
                        <p style="color: var(--text-light); font-size: 15px">
                            Dashboard statistics and key metrics
                        </p>
                    </div>
                    <!-- Stats Grid - Modern Cards -->
                    <div
                        style="
                            display: grid;
                            grid-template-columns: repeat(
                                auto-fit,
                                minmax(240px, 1fr)
                            );
                            gap: 20px;
                            margin-bottom: 30px;
                        "
                    >
                        <!-- Total Orders Card -->
                        <div
                            style="
                                background: linear-gradient(
                                    135deg,
                                    #667eea 0%,
                                    #764ba2 100%
                                );
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
                                color: white;
                                position: relative;
                                overflow: hidden;
                            "
                        >
                            <div
                                style="
                                    position: absolute;
                                    top: -20px;
                                    right: -20px;
                                    font-size: 100px;
                                    opacity: 0.2;
                                "
                            >
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <div style="position: relative; z-index: 1">
                                <div
                                    style="
                                        font-size: 14px;
                                        opacity: 0.9;
                                        margin-bottom: 8px;
                                        text-transform: uppercase;
                                        letter-spacing: 1px;
                                    "
                                >
                                    Total Orders
                                </div>
                                <div
                                    id="stat-total-orders"
                                    style="
                                        font-size: 36px;
                                        font-weight: 700;
                                        margin-bottom: 5px;
                                    "
                                >
                                    0
                                </div>
                                <div style="font-size: 13px; opacity: 0.8">
                                    <i class="fas fa-arrow-up"></i> 12% from
                                    last month
                                </div>
                            </div>
                        </div>

                        <!-- Total Revenue Card -->
                        <div
                            style="
                                background: linear-gradient(
                                    135deg,
                                    #f093fb 0%,
                                    #f5576c 100%
                                );
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 10px 30px rgba(245, 87, 108, 0.4);
                                color: white;
                                position: relative;
                                overflow: hidden;
                            "
                        >
                            <div
                                style="
                                    position: absolute;
                                    top: -20px;
                                    right: -20px;
                                    font-size: 100px;
                                    opacity: 0.2;
                                "
                            >
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div style="position: relative; z-index: 1">
                                <div
                                    style="
                                        font-size: 14px;
                                        opacity: 0.9;
                                        margin-bottom: 8px;
                                        text-transform: uppercase;
                                        letter-spacing: 1px;
                                    "
                                >
                                    Total Revenue
                                </div>
                                <div
                                    id="stat-total-revenue"
                                    style="
                                        font-size: 36px;
                                        font-weight: 700;
                                        margin-bottom: 5px;
                                    "
                                >
                                    à§³0
                                </div>
                                <div style="font-size: 13px; opacity: 0.8">
                                    <i class="fas fa-arrow-up"></i> 8% from last
                                    month
                                </div>
                            </div>
                        </div>

                        <!-- Pending Orders Card -->
                        <div
                            style="
                                background: linear-gradient(
                                    135deg,
                                    #fa709a 0%,
                                    #fee140 100%
                                );
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 10px 30px rgba(250, 112, 154, 0.4);
                                color: white;
                                position: relative;
                                overflow: hidden;
                            "
                        >
                            <div
                                style="
                                    position: absolute;
                                    top: -20px;
                                    right: -20px;
                                    font-size: 100px;
                                    opacity: 0.2;
                                "
                            >
                                <i class="fas fa-clock"></i>
                            </div>
                            <div style="position: relative; z-index: 1">
                                <div
                                    style="
                                        font-size: 14px;
                                        opacity: 0.9;
                                        margin-bottom: 8px;
                                        text-transform: uppercase;
                                        letter-spacing: 1px;
                                    "
                                >
                                    Pending Orders
                                </div>
                                <div
                                    id="stat-pending-orders"
                                    style="
                                        font-size: 36px;
                                        font-weight: 700;
                                        margin-bottom: 5px;
                                    "
                                >
                                    0
                                </div>
                                <div style="font-size: 13px; opacity: 0.8">
                                    <i class="fas fa-arrow-down"></i> 3 from
                                    yesterday
                                </div>
                            </div>
                        </div>

                        <!-- Total Customers Card -->
                        <div
                            style="
                                background: linear-gradient(
                                    135deg,
                                    #30cfd0 0%,
                                    #330867 100%
                                );
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 10px 30px rgba(48, 207, 208, 0.4);
                                color: white;
                                position: relative;
                                overflow: hidden;
                            "
                        >
                            <div
                                style="
                                    position: absolute;
                                    top: -20px;
                                    right: -20px;
                                    font-size: 100px;
                                    opacity: 0.2;
                                "
                            >
                                <i class="fas fa-users"></i>
                            </div>
                            <div style="position: relative; z-index: 1">
                                <div
                                    style="
                                        font-size: 14px;
                                        opacity: 0.9;
                                        margin-bottom: 8px;
                                        text-transform: uppercase;
                                        letter-spacing: 1px;
                                    "
                                >
                                    Total Customers
                                </div>
                                <div
                                    id="stat-total-customers"
                                    style="
                                        font-size: 36px;
                                        font-weight: 700;
                                        margin-bottom: 5px;
                                    "
                                >
                                    0
                                </div>
                                <div style="font-size: 13px; opacity: 0.8">
                                    <i class="fas fa-arrow-up"></i> 28 new this
                                    week
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div
                        style="
                            display: grid;
                            grid-template-columns: 2fr 1fr;
                            gap: 20px;
                            margin-bottom: 30px;
                        "
                    >
                        <!-- Sales Chart -->
                        <div
                            style="
                                background: white;
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
                            "
                        >
                            <h3
                                style="
                                    margin-bottom: 20px;
                                    font-size: 18px;
                                    font-weight: 600;
                                    color: var(--text-dark);
                                "
                            >
                                <i
                                    class="fas fa-chart-area"
                                    style="
                                        color: var(--primary-color);
                                        margin-right: 8px;
                                    "
                                ></i>
                                Sales Overview
                            </h3>
                            <canvas
                                id="salesChart"
                                style="max-height: 300px"
                            ></canvas>
                        </div>

                        <!-- Order Status Pie Chart -->
                        <div
                            style="
                                background: white;
                                padding: 25px;
                                border-radius: 15px;
                                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
                            "
                        >
                            <h3
                                style="
                                    margin-bottom: 20px;
                                    font-size: 18px;
                                    font-weight: 600;
                                    color: var(--text-dark);
                                "
                            >
                                <i
                                    class="fas fa-chart-pie"
                                    style="
                                        color: var(--primary-color);
                                        margin-right: 8px;
                                    "
                                ></i>
                                Order Status
                            </h3>
                            <canvas
                                id="orderStatusChart"
                                style="max-height: 300px"
                            ></canvas>
                        </div>
                    </div>

                    <!-- Recent Orders Table -->
                    <div
                        style="
                            background: white;
                            padding: 25px;
                            border-radius: 15px;
                            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
                        "
                    >
                        <h3
                            style="
                                margin-bottom: 20px;
                                font-size: 18px;
                                font-weight: 600;
                                color: var(--text-dark);
                            "
                        >
                            <i
                                class="fas fa-receipt"
                                style="
                                    color: var(--primary-color);
                                    margin-right: 8px;
                                "
                            ></i>
                            Recent Orders
                        </h3>
                        <div id="admin-orders">
                            <!-- Orders will be dynamically inserted here -->
                            <p
                                style="
                                    text-align: center;
                                    color: var(--text-light);
                                    padding: 20px;
                                "
                            >
                                Loading orders...
                            </p>
                        </div>
                    </div>
                </section>

                <!-- Customers Section -->
                <section
                    id="customers-section"
                    class="dashboard-section"
                    style="display: none"
                >
                    <div style="margin-bottom: 30px">
                        <div
                            style="
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                flex-wrap: wrap;
                                gap: 20px;
                            "
                        >
                            <div>
                                <h2
                                    style="
                                        font-size: 28px;
                                        font-weight: 700;
                                        color: var(--text-dark);
                                        margin-bottom: 10px;
                                    "
                                >
                                    <i
                                        class="fas fa-users"
                                        style="
                                            color: var(--primary-color);
                                            margin-right: 10px;
                                        "
                                    ></i>
                                    Customers Management
                                </h2>
                                <p
                                    style="
                                        color: var(--text-light);
                                        font-size: 15px;
                                    "
                                >
                                    Manage and view all customer accounts
                                </p>
                            </div>
                            <div
                                style="
                                    position: relative;
                                    max-width: 400px;
                                    width: 100%;
                                "
                            >
                                <input
                                    type="text"
                                    id="customer-search-input"
                                    placeholder="Search customers..."
                                    onkeyup="searchCustomers()"
                                    style="
                                        width: 100%;
                                        padding: 12px 45px 12px 20px;
                                        border: 2px solid #e0e0e0;
                                        border-radius: 25px;
                                        font-size: 15px;
                                        transition: all 0.3s ease;
                                    "
                                    onfocus="this.style.borderColor='#667eea'; this.style.outline='none';"
                                    onblur="this.style.borderColor='#e0e0e0';"
                                />
                                <i
                                    class="fas fa-search"
                                    style="
                                        position: absolute;
                                        right: 20px;
                                        top: 50%;
                                        transform: translateY(-50%);
                                        color: #999;
                                    "
                                ></i>
                            </div>
                        </div>
                    </div>
                    <div
                        style="
                            background: white;
                            padding: 30px;
                            border-radius: var(--border-radius);
                            box-shadow: var(--shadow);
                            overflow-x: auto;
                        "
                    >
                        <table
                            class="data-table"
                            style="width: 100%; border-collapse: collapse"
                        >
                            <thead>
                                <tr>
                                    <th
                                        style="
                                            background: linear-gradient(
                                                135deg,
                                                var(--primary-color) 0%,
                                                var(--secondary-color) 100%
                                            );
                                            color: white;
                                            padding: 18px 15px;
                                            text-align: left;
                                            font-weight: 600;
                                            font-size: 15px;
                                            white-space: nowrap;
                                        "
                                    >
                                        Customer Name
                                    </th>
                                    <th
                                        style="
                                            background: linear-gradient(
                                                135deg,
                                                var(--primary-color) 0%,
                                                var(--secondary-color) 100%
                                            );
                                            color: white;
                                            padding: 18px 15px;
                                            text-align: left;
                                            font-weight: 600;
                                            font-size: 15px;
                                            white-space: nowrap;
                                        "
                                    >
                                        Email
                                    </th>
                                    <th
                                        style="
                                            background: linear-gradient(
                                                135deg,
                                                var(--primary-color) 0%,
                                                var(--secondary-color) 100%
                                            );
                                            color: white;
                                            padding: 18px 15px;
                                            text-align: left;
                                            font-weight: 600;
                                            font-size: 15px;
                                            white-space: nowrap;
                                        "
                                    >
                                        Total Spent
                                    </th>
                                    <th
                                        style="
                                            background: linear-gradient(
                                                135deg,
                                                var(--primary-color) 0%,
                                                var(--secondary-color) 100%
                                            );
                                            color: white;
                                            padding: 18px 15px;
                                            text-align: left;
                                            font-weight: 600;
                                            font-size: 15px;
                                            white-space: nowrap;
                                        "
                                    >
                                        Total Orders
                                    </th>
                                    <th
                                        style="
                                            background: linear-gradient(
                                                135deg,
                                                var(--primary-color) 0%,
                                                var(--secondary-color) 100%
                                            );
                                            color: white;
                                            padding: 18px 15px;
                                            text-align: left;
                                            font-weight: 600;
                                            font-size: 15px;
                                            white-space: nowrap;
                                        "
                                    >
                                        Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="customers-tbody"></tbody>
                        </table>
                    </div>
                </section>

                <!-- Delivery Section -->
                <section
                    id="delivery-section"
                    class="dashboard-section"
                    style="display: none"
                >
                    <div style="margin-bottom: 30px">
                        <div
                            style="
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                flex-wrap: wrap;
                                gap: 20px;
                            "
                        >
                            <div>
                                <h2
                                    style="
                                        font-size: 28px;
                                        font-weight: 700;
                                        color: var(--text-dark);
                                        margin-bottom: 10px;
                                    "
                                >
                                    <i
                                        class="fas fa-truck"
                                        style="
                                            color: var(--primary-color);
                                            margin-right: 10px;
                                        "
                                    ></i>
                                    Delivery Men Management
                                </h2>
                                <p
                                    style="
                                        color: var(--text-light);
                                        font-size: 15px;
                                    "
                                >
                                    Manage delivery personnel and track
                                    deliveries
                                </p>
                            </div>
                            <button
                                class="btn btn-primary"
                                onclick="openAddDeliveryManDialog()"
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 8px;
                                "
                            >
                                <i class="fas fa-plus"></i>
                                Add Delivery Man
                            </button>
                        </div>
                    </div>
                    <div
                        id="delivery-men-container"
                        style="margin-bottom: 30px"
                    >
                        <!-- Delivery men will be loaded here -->
                        <div
                            style="
                                text-align: center;
                                padding: 40px;
                                background: white;
                                border-radius: var(--border-radius);
                                box-shadow: var(--shadow);
                            "
                        >
                            <i
                                class="fas fa-spinner fa-spin"
                                style="font-size: 24px"
                            ></i>
                            <p>Loading delivery men...</p>
                        </div>
                    </div>
                </section>

                <!-- Product Requests Section -->
                <section
                    id="product-requests-section"
                    class="dashboard-section"
                    style="display: none"
                >
                    <div style="margin-bottom: 30px">
                        <h2
                            style="
                                font-size: 28px;
                                font-weight: 700;
                                color: var(--text-dark);
                                margin-bottom: 10px;
                            "
                        >
                            <i
                                class="fas fa-comments"
                                style="
                                    color: var(--primary-color);
                                    margin-right: 10px;
                                "
                            ></i>
                            Product Requests
                        </h2>
                        <p style="color: var(--text-light); font-size: 15px">
                            Manage customer product requests
                        </p>
                    </div>

                    <!-- Filter Tabs -->
                    <div
                        style="
                            margin-bottom: 20px;
                            display: flex;
                            gap: 10px;
                            flex-wrap: wrap;
                        "
                    >
                        <button
                            class="btn btn-sm"
                            onclick="filterProductRequests(null)"
                            id="filter-all"
                            style="
                                background: var(--primary-color);
                                color: white;
                            "
                        >
                            All Requests
                        </button>
                        <button
                            class="btn btn-sm"
                            onclick="filterProductRequests('pending')"
                            id="filter-pending"
                        >
                            Pending
                        </button>
                        <button
                            class="btn btn-sm"
                            onclick="filterProductRequests('approved')"
                            id="filter-approved"
                        >
                            Approved
                        </button>
                        <button
                            class="btn btn-sm"
                            onclick="filterProductRequests('rejected')"
                            id="filter-rejected"
                        >
                            Rejected
                        </button>
                    </div>

                    <!-- Requests Table -->
                    <div
                        style="
                            background: white;
                            padding: 30px;
                            border-radius: var(--border-radius);
                            box-shadow: var(--shadow);
                        "
                    >
                        <div id="product-requests-container">
                            <div style="text-align: center; padding: 40px">
                                <i
                                    class="fas fa-spinner fa-spin"
                                    style="
                                        font-size: 32px;
                                        color: var(--primary-color);
                                    "
                                ></i>
                                <p
                                    style="
                                        margin-top: 15px;
                                        color: var(--text-light);
                                    "
                                >
                                    Loading requests...
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section
                    id="settings-section"
                    class="dashboard-section"
                    style="display: none"
                >
                    <div style="margin-bottom: 30px">
                        <h2
                            style="
                                font-size: 28px;
                                font-weight: 700;
                                color: var(--text-dark);
                                margin-bottom: 10px;
                            "
                        >
                            <i
                                class="fas fa-cog"
                                style="
                                    color: var(--primary-color);
                                    margin-right: 10px;
                                "
                            ></i>
                            Settings
                        </h2>
                        <p style="color: var(--text-light); font-size: 15px">
                            Configure store settings and preferences
                        </p>
                    </div>
                    <div
                        style="
                            background: white;
                            padding: 30px;
                            border-radius: var(--border-radius);
                            box-shadow: var(--shadow);
                        "
                    >
                        <form>
                            <h3 style="margin-bottom: 20px">
                                Store Information
                            </h3>

                            <div class="form-group">
                                <label class="form-label">Store Name</label>
                                <input
                                    type="text"
                                    class="form-input"
                                    value="MoonCart"
                                />
                            </div>

                            <div class="form-group">
                                <label class="form-label">Contact Email</label>
                                <input
                                    type="email"
                                    class="form-input"
                                    value="info@mooncart.com"
                                />
                            </div>

                            <div class="form-group">
                                <label class="form-label">Contact Phone</label>
                                <input
                                    type="tel"
                                    class="form-input"
                                    value="+1 234 567 8900"
                                />
                            </div>

                            <div class="form-group">
                                <label class="form-label">Store Address</label>
                                <textarea class="form-textarea">
123 Main Street, City, Country</textarea
                                >
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </form>
                    </div>
                </section>
            </main>
        </div>

        <!-- Order Details Modal -->
        <div
            id="order-details-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    max-width: 900px;
                    width: 90%;
                    background: white;
                    border-radius: 15px;
                    max-height: 90vh;
                    overflow-y: auto;
                    position: relative;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                    animation: slideDown 0.3s ease;
                "
            >
                <div
                    style="
                        background: linear-gradient(
                            135deg,
                            #667eea 0%,
                            #764ba2 100%
                        );
                        padding: 25px;
                        border-radius: 15px 15px 0 0;
                        position: relative;
                    "
                >
                    <h2 style="margin: 0; color: white; font-size: 24px">
                        <i class="fas fa-receipt"></i> Order Details
                    </h2>
                    <span
                        class="modal-close"
                        onclick="document.getElementById('order-details-modal').classList.remove('active')"
                        style="
                            position: absolute;
                            right: 20px;
                            top: 20px;
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div id="order-modal-content" style="padding: 30px"></div>
            </div>
        </div>

        <!-- Edit Product Modal -->
        <div
            id="edit-product-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    background: white;
                    border-radius: 15px;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                    animation: slideDown 0.3s ease;
                "
            >
                <div
                    style="
                        background: linear-gradient(
                            135deg,
                            #667eea 0%,
                            #764ba2 100%
                        );
                        padding: 25px;
                        border-radius: 15px 15px 0 0;
                        position: relative;
                    "
                >
                    <h2 style="margin: 0; color: white; font-size: 24px">
                        <i class="fas fa-edit"></i> Edit Product
                    </h2>
                    <span
                        onclick="closeEditProductModal()"
                        style="
                            position: absolute;
                            right: 20px;
                            top: 20px;
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div style="padding: 30px">
                    <div style="margin-bottom: 20px">
                        <label
                            style="
                                display: block;
                                margin-bottom: 8px;
                                color: #333;
                                font-weight: 600;
                            "
                            >Product Name</label
                        >
                        <input
                            type="text"
                            id="edit-product-name"
                            readonly
                            style="
                                width: 100%;
                                padding: 12px;
                                border: 2px solid #e0e0e0;
                                border-radius: 8px;
                                font-size: 14px;
                                background: #f5f5f5;
                            "
                        />
                    </div>
                    <div style="margin-bottom: 20px">
                        <label
                            style="
                                display: block;
                                margin-bottom: 8px;
                                color: #333;
                                font-weight: 600;
                            "
                            >Price (à§³)</label
                        >
                        <input
                            type="number"
                            id="edit-product-price"
                            placeholder="Enter price"
                            style="
                                width: 100%;
                                padding: 12px;
                                border: 2px solid #e0e0e0;
                                border-radius: 8px;
                                font-size: 14px;
                            "
                            step="0.01"
                        />
                    </div>
                    <div style="margin-bottom: 25px">
                        <label
                            style="
                                display: block;
                                margin-bottom: 8px;
                                color: #333;
                                font-weight: 600;
                            "
                            >Stock Quantity</label
                        >
                        <input
                            type="number"
                            id="edit-product-stock"
                            placeholder="Enter stock quantity"
                            style="
                                width: 100%;
                                padding: 12px;
                                border: 2px solid #e0e0e0;
                                border-radius: 8px;
                                font-size: 14px;
                            "
                        />
                    </div>
                    <div
                        style="
                            display: flex;
                            gap: 10px;
                            justify-content: flex-end;
                        "
                    >
                        <button
                            onclick="closeEditProductModal()"
                            style="
                                padding: 12px 24px;
                                background: #6c757d;
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                            "
                        >
                            Cancel
                        </button>
                        <button
                            onclick="saveProductChanges()"
                            style="
                                padding: 12px 24px;
                                background: linear-gradient(
                                    135deg,
                                    #667eea 0%,
                                    #764ba2 100%
                                );
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                            "
                        >
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Decline Order Modal -->
        <div
            id="decline-order-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    background: white;
                    border-radius: 15px;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                "
            >
                <div
                    style="
                        background: linear-gradient(
                            135deg,
                            #f093fb 0%,
                            #f5576c 100%
                        );
                        padding: 25px;
                        border-radius: 15px 15px 0 0;
                        position: relative;
                    "
                >
                    <h2 style="margin: 0; color: white; font-size: 24px">
                        <i class="fas fa-times-circle"></i> Decline Order
                    </h2>
                    <span
                        onclick="closeDeclineModal()"
                        style="
                            position: absolute;
                            right: 20px;
                            top: 20px;
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div style="padding: 30px">
                    <p style="margin-bottom: 20px; color: #666">
                        Please provide a reason for declining this order:
                    </p>
                    <textarea
                        id="decline-reason"
                        placeholder="Enter reason for declining..."
                        style="
                            width: 100%;
                            padding: 12px;
                            border: 2px solid #e0e0e0;
                            border-radius: 8px;
                            font-size: 14px;
                            min-height: 100px;
                            font-family: inherit;
                        "
                        maxlength="500"
                    ></textarea>
                    <div
                        style="
                            margin-top: 25px;
                            display: flex;
                            gap: 10px;
                            justify-content: flex-end;
                        "
                    >
                        <button
                            onclick="closeDeclineModal()"
                            style="
                                padding: 12px 24px;
                                background: #6c757d;
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                            "
                        >
                            Cancel
                        </button>
                        <button
                            onclick="confirmDeclineOrder()"
                            style="
                                padding: 12px 24px;
                                background: linear-gradient(
                                    135deg,
                                    #f093fb 0%,
                                    #f5576c 100%
                                );
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                            "
                        >
                            <i class="fas fa-check"></i> Confirm Decline
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Assign Delivery Modal -->
        <div
            id="assign-delivery-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    background: white;
                    border-radius: 15px;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                "
            >
                <div
                    style="
                        background: linear-gradient(
                            135deg,
                            #30cfd0 0%,
                            #330867 100%
                        );
                        padding: 25px;
                        border-radius: 15px 15px 0 0;
                        position: relative;
                    "
                >
                    <h2 style="margin: 0; color: white; font-size: 24px">
                        <i class="fas fa-user-tie"></i> Assign Delivery Person
                    </h2>
                    <span
                        onclick="closeAssignModal()"
                        style="
                            position: absolute;
                            right: 20px;
                            top: 20px;
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div style="padding: 30px">
                    <p style="margin-bottom: 20px; color: #666">
                        Select a delivery person for this order:
                    </p>
                    <div
                        id="delivery-person-list"
                        style="margin-bottom: 25px"
                    ></div>
                    <div
                        style="
                            display: flex;
                            gap: 10px;
                            justify-content: flex-end;
                        "
                    >
                        <button
                            onclick="closeAssignModal()"
                            style="
                                padding: 12px 24px;
                                background: #6c757d;
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                            "
                        >
                            Cancel
                        </button>
                        <button
                            onclick="confirmAssignDelivery()"
                            style="
                                padding: 12px 24px;
                                background: linear-gradient(
                                    135deg,
                                    #30cfd0 0%,
                                    #330867 100%
                                );
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                            "
                        >
                            <i class="fas fa-check"></i> Assign
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal (for delete, etc.) -->
        <div
            id="confirm-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    background: white;
                    border-radius: 15px;
                    max-width: 450px;
                    width: 90%;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                "
            >
                <div
                    style="
                        background: linear-gradient(
                            135deg,
                            #fa709a 0%,
                            #fee140 100%
                        );
                        padding: 25px;
                        border-radius: 15px 15px 0 0;
                        position: relative;
                    "
                >
                    <h2 style="margin: 0; color: white; font-size: 24px">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span id="confirm-title">Confirm Action</span>
                    </h2>
                    <span
                        onclick="closeConfirmModal()"
                        style="
                            position: absolute;
                            right: 20px;
                            top: 20px;
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div style="padding: 30px">
                    <p
                        id="confirm-message"
                        style="
                            margin-bottom: 25px;
                            color: #666;
                            font-size: 16px;
                        "
                    ></p>
                    <div
                        style="
                            display: flex;
                            gap: 10px;
                            justify-content: flex-end;
                        "
                    >
                        <button
                            onclick="closeConfirmModal()"
                            style="
                                padding: 12px 24px;
                                background: #6c757d;
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                            "
                        >
                            Cancel
                        </button>
                        <button
                            id="confirm-action-btn"
                            onclick="confirmAction()"
                            style="
                                padding: 12px 24px;
                                background: linear-gradient(
                                    135deg,
                                    #fa709a 0%,
                                    #fee140 100%
                                );
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                            "
                        >
                            <i class="fas fa-check"></i> Confirm
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Details Modal -->
        <div
            id="customer-details-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    background: white;
                    border-radius: 15px;
                    max-width: 1000px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                    animation: slideDown 0.3s ease;
                "
            >
                <div
                    style="
                        background: linear-gradient(
                            135deg,
                            #30cfd0 0%,
                            #330867 100%
                        );
                        padding: 25px;
                        border-radius: 15px 15px 0 0;
                        position: relative;
                    "
                >
                    <h2 style="margin: 0; color: white; font-size: 24px">
                        <i class="fas fa-user-circle"></i> Customer Details
                    </h2>
                    <span
                        onclick="closeCustomerDetailsModal()"
                        style="
                            position: absolute;
                            right: 20px;
                            top: 20px;
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div id="customer-details-content" style="padding: 30px"></div>
            </div>
        </div>

        <style>
            @keyframes slideDown {
                from {
                    transform: translateY(-50px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            .modal {
                display: none;
            }

            .modal.active {
                display: flex !important;
            }

            .delivery-person-item {
                padding: 15px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                margin-bottom: 10px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .delivery-person-item:hover {
                border-color: #30cfd0;
                background: #f0f9ff;
            }

            .delivery-person-item.selected {
                border-color: #30cfd0;
                background: linear-gradient(
                    135deg,
                    rgba(48, 207, 208, 0.1) 0%,
                    rgba(51, 8, 103, 0.1) 100%
                );
            }
        </style>

        <!-- Customer Profile Modal -->
        <div
            id="profile-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    background: white;
                    border-radius: 20px;
                    max-width: 600px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                    animation: slideDown 0.3s ease;
                "
            >
                <div
                    class="modal-header"
                    style="
                        background: linear-gradient(
                            135deg,
                            var(--primary-color) 0%,
                            var(--secondary-color) 100%
                        );
                        padding: 25px 30px;
                        border-radius: 20px 20px 0 0;
                        position: relative;
                    "
                >
                    <h2
                        style="
                            margin: 0;
                            color: white;
                            font-size: 24px;
                            font-weight: 700;
                        "
                    >
                        <i class="fas fa-user-circle"></i> Customer Profile
                    </h2>
                    <span
                        class="modal-close"
                        onclick="closeProfileModal()"
                        style="
                            position: absolute;
                            right: 25px;
                            top: 50%;
                            transform: translateY(-50%);
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div
                    class="modal-body"
                    id="profile-modal-body"
                    style="padding: 30px"
                ></div>
            </div>
        </div>

        <!-- Customer Orders Modal -->
        <div
            id="orders-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    background: white;
                    border-radius: 20px;
                    max-width: 900px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                    animation: slideDown 0.3s ease;
                "
            >
                <div
                    class="modal-header"
                    style="
                        background: linear-gradient(
                            135deg,
                            #30cfd0 0%,
                            #330867 100%
                        );
                        padding: 25px 30px;
                        border-radius: 20px 20px 0 0;
                        position: relative;
                    "
                >
                    <h2
                        style="
                            margin: 0;
                            color: white;
                            font-size: 24px;
                            font-weight: 700;
                        "
                    >
                        <i class="fas fa-shopping-bag"></i> Customer Orders
                    </h2>
                    <span
                        class="modal-close"
                        onclick="closeOrdersModal()"
                        style="
                            position: absolute;
                            right: 25px;
                            top: 50%;
                            transform: translateY(-50%);
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div
                    class="modal-body"
                    id="orders-modal-body"
                    style="padding: 30px"
                ></div>
            </div>
        </div>

        <!-- Delivery Man Dialog -->
        <div
            id="delivery-man-dialog"
            class="custom-dialog"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10000;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="dialog-content"
                style="
                    background: white;
                    border-radius: 15px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
                    position: relative;
                "
            >
                <div
                    class="dialog-header"
                    style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 25px;
                        padding-bottom: 15px;
                        border-bottom: 2px solid #f0f0f0;
                    "
                >
                    <h2
                        id="dialog-title"
                        style="
                            margin: 0;
                            font-size: 24px;
                            color: var(--text-dark);
                        "
                    >
                        <i class="fas fa-user-plus"></i> Add Delivery Man
                    </h2>
                    <button
                        class="dialog-close"
                        onclick="closeDeliveryManDialog()"
                        style="
                            background: none;
                            border: none;
                            font-size: 28px;
                            cursor: pointer;
                            color: #999;
                            padding: 0;
                            width: 30px;
                            height: 30px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            border-radius: 50%;
                            transition: all 0.3s ease;
                        "
                    >
                        &times;
                    </button>
                </div>
                <div class="dialog-body">
                    <form
                        id="delivery-man-form"
                        onsubmit="saveDeliveryMan(event)"
                    >
                        <input type="hidden" id="delivery-man-id" />
                        <div class="form-group" style="margin-bottom: 20px">
                            <label
                                class="form-label"
                                style="
                                    display: block;
                                    margin-bottom: 8px;
                                    font-weight: 600;
                                    color: var(--text-dark);
                                    font-size: 14px;
                                "
                                >Name *</label
                            >
                            <input
                                type="text"
                                id="delivery-man-name"
                                class="form-input"
                                placeholder="Enter full name"
                                required
                                style="
                                    width: 100%;
                                    padding: 12px 15px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    transition: all 0.3s ease;
                                    font-family: inherit;
                                "
                            />
                        </div>
                        <div class="form-group" style="margin-bottom: 20px">
                            <label
                                class="form-label"
                                style="
                                    display: block;
                                    margin-bottom: 8px;
                                    font-weight: 600;
                                    color: var(--text-dark);
                                    font-size: 14px;
                                "
                                >Phone Number *</label
                            >
                            <input
                                type="tel"
                                id="delivery-man-phone"
                                class="form-input"
                                placeholder="Enter phone number"
                                required
                                style="
                                    width: 100%;
                                    padding: 12px 15px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    transition: all 0.3s ease;
                                    font-family: inherit;
                                "
                            />
                        </div>
                        <div class="form-group" style="margin-bottom: 20px">
                            <label
                                class="form-label"
                                style="
                                    display: block;
                                    margin-bottom: 8px;
                                    font-weight: 600;
                                    color: var(--text-dark);
                                    font-size: 14px;
                                "
                                >NID (National ID) *</label
                            >
                            <input
                                type="text"
                                id="delivery-man-nid"
                                class="form-input"
                                placeholder="Enter NID number"
                                required
                                style="
                                    width: 100%;
                                    padding: 12px 15px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    transition: all 0.3s ease;
                                    font-family: inherit;
                                "
                            />
                        </div>
                        <div class="form-group" style="margin-bottom: 20px">
                            <label
                                class="form-label"
                                style="
                                    display: block;
                                    margin-bottom: 8px;
                                    font-weight: 600;
                                    color: var(--text-dark);
                                    font-size: 14px;
                                "
                                >Profile Image URL (Optional)</label
                            >
                            <input
                                type="url"
                                id="delivery-man-image"
                                class="form-input"
                                placeholder="https://example.com/image.jpg"
                                style="
                                    width: 100%;
                                    padding: 12px 15px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    transition: all 0.3s ease;
                                    font-family: inherit;
                                "
                            />
                        </div>
                        <div class="form-group" style="margin-bottom: 20px">
                            <label
                                class="form-label"
                                style="
                                    display: block;
                                    margin-bottom: 8px;
                                    font-weight: 600;
                                    color: var(--text-dark);
                                    font-size: 14px;
                                "
                                >Status</label
                            >
                            <select
                                id="delivery-man-status"
                                class="form-input"
                                style="
                                    width: 100%;
                                    padding: 12px 15px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    transition: all 0.3s ease;
                                    font-family: inherit;
                                "
                            >
                                <option value="1">Active</option>
                                <option value="0">Inactive</option>
                            </select>
                        </div>
                        <div
                            class="dialog-footer"
                            style="
                                display: flex;
                                gap: 10px;
                                justify-content: flex-end;
                                margin-top: 25px;
                            "
                        >
                            <button
                                type="button"
                                class="btn-dialog btn-dialog-secondary"
                                onclick="closeDeliveryManDialog()"
                                style="
                                    padding: 12px 24px;
                                    border: none;
                                    border-radius: 8px;
                                    font-weight: 600;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    font-size: 14px;
                                    background: #f0f0f0;
                                    color: var(--text-dark);
                                "
                            >
                                Cancel
                            </button>
                            <button
                                type="submit"
                                class="btn-dialog btn-dialog-primary"
                                style="
                                    padding: 12px 24px;
                                    border: none;
                                    border-radius: 8px;
                                    font-weight: 600;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    font-size: 14px;
                                    background: linear-gradient(
                                        135deg,
                                        var(--primary-color),
                                        var(--secondary-color)
                                    );
                                    color: white;
                                "
                            >
                                Save
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Product Request View Modal -->
        <div
            id="product-request-view-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    background: white;
                    border-radius: 20px;
                    max-width: 800px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                    animation: slideDown 0.3s ease;
                "
            >
                <div
                    class="modal-header"
                    style="
                        background: linear-gradient(
                            135deg,
                            var(--primary-color) 0%,
                            var(--secondary-color) 100%
                        );
                        padding: 25px 30px;
                        border-radius: 20px 20px 0 0;
                        position: relative;
                    "
                >
                    <h2
                        style="
                            margin: 0;
                            color: white;
                            font-size: 24px;
                            font-weight: 700;
                        "
                    >
                        <i class="fas fa-eye"></i> Product Request Details
                    </h2>
                    <span
                        class="modal-close"
                        onclick="closeProductRequestViewModal()"
                        style="
                            position: absolute;
                            right: 25px;
                            top: 50%;
                            transform: translateY(-50%);
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div
                    class="modal-body"
                    id="product-request-view-body"
                    style="padding: 30px"
                ></div>
            </div>
        </div>

        <!-- Accept Product Request Modal -->
        <div
            id="accept-request-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    background: white;
                    border-radius: 20px;
                    max-width: 600px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                    animation: slideDown 0.3s ease;
                "
            >
                <div
                    class="modal-header"
                    style="
                        background: linear-gradient(
                            135deg,
                            #28a745 0%,
                            #20c997 100%
                        );
                        padding: 25px 30px;
                        border-radius: 20px 20px 0 0;
                        position: relative;
                    "
                >
                    <h2
                        style="
                            margin: 0;
                            color: white;
                            font-size: 24px;
                            font-weight: 700;
                        "
                    >
                        <i class="fas fa-check-circle"></i> Accept Product
                        Request
                    </h2>
                    <span
                        class="modal-close"
                        onclick="closeAcceptRequestModal()"
                        style="
                            position: absolute;
                            right: 25px;
                            top: 50%;
                            transform: translateY(-50%);
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div class="modal-body" style="padding: 30px">
                    <form
                        id="accept-request-form"
                        onsubmit="submitAcceptRequest(event)"
                    >
                        <div class="form-group">
                            <label class="form-label"
                                >Delivery Time
                                <span style="color: red">*</span></label
                            >
                            <input
                                type="datetime-local"
                                id="accept-delivery-time"
                                class="form-input"
                                required
                            />
                        </div>
                        <div class="form-group">
                            <label class="form-label"
                                >Delivery Man
                                <span style="color: red">*</span></label
                            >
                            <select
                                id="accept-delivery-man"
                                class="form-input"
                                required
                            >
                                <option value="">Select Delivery Man</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label"
                                >Admin Notes (Optional)</label
                            >
                            <textarea
                                id="accept-admin-notes"
                                class="form-input"
                                rows="3"
                                placeholder="Add any additional notes..."
                            ></textarea>
                        </div>
                        <div
                            style="
                                display: flex;
                                gap: 10px;
                                justify-content: flex-end;
                                margin-top: 20px;
                            "
                        >
                            <button
                                type="button"
                                class="btn btn-secondary"
                                onclick="closeAcceptRequestModal()"
                            >
                                Cancel
                            </button>
                            <button
                                type="submit"
                                class="btn btn-primary"
                                style="background: #28a745"
                            >
                                Accept Request
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Reject Product Request Modal -->
        <div
            id="reject-request-modal"
            class="modal"
            style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9999;
                align-items: center;
                justify-content: center;
            "
        >
            <div
                class="modal-content"
                style="
                    background: white;
                    border-radius: 20px;
                    max-width: 600px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                    animation: slideDown 0.3s ease;
                "
            >
                <div
                    class="modal-header"
                    style="
                        background: linear-gradient(
                            135deg,
                            #dc3545 0%,
                            #c82333 100%
                        );
                        padding: 25px 30px;
                        border-radius: 20px 20px 0 0;
                        position: relative;
                    "
                >
                    <h2
                        style="
                            margin: 0;
                            color: white;
                            font-size: 24px;
                            font-weight: 700;
                        "
                    >
                        <i class="fas fa-times-circle"></i> Reject Product
                        Request
                    </h2>
                    <span
                        class="modal-close"
                        onclick="closeRejectRequestModal()"
                        style="
                            position: absolute;
                            right: 25px;
                            top: 50%;
                            transform: translateY(-50%);
                            font-size: 28px;
                            cursor: pointer;
                            color: white;
                            opacity: 0.9;
                        "
                        >&times;</span
                    >
                </div>
                <div class="modal-body" style="padding: 30px">
                    <form
                        id="reject-request-form"
                        onsubmit="submitRejectRequest(event)"
                    >
                        <div class="form-group">
                            <label class="form-label"
                                >Rejection Reason
                                <span style="color: red">*</span></label
                            >
                            <textarea
                                id="reject-reason"
                                class="form-input"
                                rows="4"
                                placeholder="Please provide a reason for rejecting this request..."
                                required
                            ></textarea>
                        </div>
                        <div
                            style="
                                display: flex;
                                gap: 10px;
                                justify-content: flex-end;
                                margin-top: 20px;
                            "
                        >
                            <button
                                type="button"
                                class="btn btn-secondary"
                                onclick="closeRejectRequestModal()"
                            >
                                Cancel
                            </button>
                            <button
                                type="submit"
                                class="btn btn-primary"
                                style="background: #dc3545"
                            >
                                Reject Request
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="js/main.js"></script>
        <script src="js/api.js"></script>
        <script src="js/order.js"></script>
        <script src="js/ui.js"></script>
        <script>
            // Check if user is logged in as admin - redirect if not
            const currentUser = MoonCart.getCurrentUser();
            if (!currentUser || currentUser.role !== "admin") {
                MoonCart.showNotification(
                    "Access denied. Admin login required.",
                    "error"
                );
                setTimeout(() => {
                    window.location.href = "login.html";
                }, 1500);
            }

            // Show section function for sidebar navigation
            function showSection(sectionId, element) {
                // Hide all sections
                const sections =
                    document.querySelectorAll(".dashboard-section");
                sections.forEach((section) => (section.style.display = "none"));

                // Show selected section
                const targetSection = document.getElementById(
                    `${sectionId}-section`
                );
                if (targetSection) {
                    targetSection.style.display = "block";
                }

                // Update active link
                const links = document.querySelectorAll(".sidebar-link");
                links.forEach((link) => link.classList.remove("active"));
                if (element) {
                    element.classList.add("active");
                }
            }

            // Make showSection globally available
            window.showSection = showSection;

            // Global data stores
            let allOrders = [];
            let allProducts = [];
            let allCustomers = [];
            let dashboardStats = {
                totalOrders: 0,
                pendingOrders: 0,
                totalRevenue: 0,
                totalCustomers: 0,
            };

            // Initialize dashboard on page load
            document.addEventListener("DOMContentLoaded", async function () {
                MoonCart.showLoading();

                // Check for hash in URL and show corresponding section
                const hash = window.location.hash.substring(1);
                if (
                    hash &&
                    [
                        "overview",
                        "customers",
                        "delivery",
                        "product-requests",
                        "settings",
                    ].includes(hash)
                ) {
                    const sectionLink = document.querySelector(
                        `.sidebar-link[href="#${hash}"]`
                    );
                    if (sectionLink) {
                        showSection(hash, sectionLink);
                    }
                }

                // Load all data in parallel
                await Promise.all([
                    loadDashboardOrders(),
                    loadDashboardProducts(),
                    loadDashboardCustomers(),
                ]);

                MoonCart.hideLoading();

                // Update UI
                updateDashboardStats();
                renderRecentOrders();
                renderAllOrders();
                renderAllProducts();
                renderAllCustomers();
                initCharts();
            });

            // Load orders from backend
            async function loadDashboardOrders() {
                try {
                    const response = await MoonCartAPI.getAllOrders();
                    if (response.success && response.orders) {
                        allOrders = response.orders;
                    }
                } catch (error) {
                    console.error("Failed to load orders:", error);
                    allOrders = [];
                }
            }

            // Load products from backend
            async function loadDashboardProducts() {
                try {
                    const response = await MoonCartAPI.getProducts();
                    if (response.success && response.products) {
                        allProducts = response.products;
                    }
                } catch (error) {
                    console.error("Failed to load products:", error);
                    allProducts = [];
                }
            }

            // Load customers from backend
            async function loadDashboardCustomers() {
                try {
                    const response = await MoonCartAPI.getAllUsers("customer");
                    if (response.success && response.users) {
                        allCustomers = response.users;
                    }
                } catch (error) {
                    console.error("Failed to load customers:", error);
                    allCustomers = [];
                }
            }

            // Calculate monthly revenue from backend orders
            function calculateMonthlyRevenue() {
                // Group orders by month and calculate revenue
                const now = new Date();
                const months = [];
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(
                        now.getFullYear(),
                        now.getMonth() - i,
                        1
                    );
                    const monthOrders = allOrders.filter((order) => {
                        const orderDate = new Date(
                            order.created_at || order.orderDate
                        );
                        return (
                            orderDate.getMonth() === date.getMonth() &&
                            orderDate.getFullYear() === date.getFullYear() &&
                            order.status !== "cancelled"
                        );
                    });
                    const revenue = monthOrders.reduce(
                        (sum, o) => sum + parseFloat(o.total || 0),
                        0
                    );
                    months.push(Math.round(revenue));
                }
                return months;
            }

            // Update dashboard stats
            function updateDashboardStats() {
                dashboardStats = {
                    totalOrders: allOrders.length,
                    pendingOrders: allOrders.filter(
                        (o) =>
                            o.status === "pending" || o.status === "confirmed"
                    ).length,
                    totalRevenue: allOrders
                        .filter((o) => o.status !== "cancelled")
                        .reduce((sum, o) => sum + parseFloat(o.total || 0), 0),
                    totalCustomers: allCustomers.length,
                };

                // Update stat cards using IDs
                const totalOrdersEl =
                    document.getElementById("stat-total-orders");
                const totalRevenueEl =
                    document.getElementById("stat-total-revenue");
                const pendingOrdersEl = document.getElementById(
                    "stat-pending-orders"
                );
                const totalCustomersEl = document.getElementById(
                    "stat-total-customers"
                );

                if (totalOrdersEl)
                    totalOrdersEl.textContent = dashboardStats.totalOrders;
                if (totalRevenueEl)
                    totalRevenueEl.textContent =
                        "à§³" +
                        MoonCart.formatCurrency(dashboardStats.totalRevenue);
                if (pendingOrdersEl)
                    pendingOrdersEl.textContent = dashboardStats.pendingOrders;
                if (totalCustomersEl)
                    totalCustomersEl.textContent =
                        dashboardStats.totalCustomers;
            }

            // Render recent orders in overview section
            function renderRecentOrders() {
                const container = document.getElementById("admin-orders");
                if (!container) return;

                const recentOrders = allOrders.slice(0, 5);

                if (recentOrders.length === 0) {
                    container.innerHTML =
                        '<div class="empty-state"><h3>No orders yet</h3><p>Orders will appear here once customers start placing them.</p></div>';
                    return;
                }

                container.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recentOrders
                                .map(
                                    (order) => `
                                <tr>
                                    <td>#${String(
                                        order.order_number || order.id
                                    )
                                        .substring(0, 12)
                                        .toUpperCase()}</td>
                                    <td>${
                                        order.customer_name ||
                                        order.customerName ||
                                        "N/A"
                                    }</td>
                                    <td>${
                                        order.item_count ||
                                        order.items?.length ||
                                        0
                                    } items</td>
                                    <td>à§³${parseFloat(
                                        order.total
                                    ).toLocaleString()}</td>
                                    <td><span class="status-badge status-${
                                        order.status
                                    }">${order.status}</span></td>
                                    <td>
                                        <button class="btn btn-sm" onclick="viewAdminOrderDetails('${
                                            order.id
                                        }')" style="background: #007bff; color: white;">View</button>
                                        ${
                                            order.status === "pending"
                                                ? `
                                            <button class="btn btn-sm" onclick="updateOrderStatusAdmin('${order.id}', 'confirmed')" style="background: #28a745; color: white;">Accept</button>
                                            <button class="btn btn-sm" onclick="updateOrderStatusAdmin('${order.id}', 'cancelled')" style="background: #dc3545; color: white;">Decline</button>
                                        `
                                                : ""
                                        }
                                    </td>
                                </tr>
                            `
                                )
                                .join("")}
                        </tbody>
                    </table>
                `;
            }

            // Render all orders in orders section
            function renderAllOrders() {
                const container = document.getElementById("admin-orders-full");
                if (!container) return;

                if (allOrders.length === 0) {
                    container.innerHTML =
                        '<div class="empty-state"><h3>No orders yet</h3></div>';
                    return;
                }

                container.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Email</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allOrders
                                .map(
                                    (order) => `
                                <tr>
                                    <td>#${String(
                                        order.order_number || order.id
                                    )
                                        .substring(0, 12)
                                        .toUpperCase()}</td>
                                    <td>${formatDate(order.created_at)}</td>
                                    <td>${order.customer_name || "N/A"}</td>
                                    <td>${order.email || "N/A"}</td>
                                    <td>${order.item_count || 0} items</td>
                                    <td>à§³${parseFloat(
                                        order.total
                                    ).toLocaleString()}</td>
                                    <td><span class="status-badge status-${
                                        order.status
                                    }">${order.status}</span></td>
                                    <td>
                                        <button class="btn btn-sm" onclick="viewAdminOrderDetails('${
                                            order.id
                                        }')" style="background: #007bff; color: white;">View</button>
                                        <select onchange="updateOrderStatusAdmin('${
                                            order.id
                                        }', this.value)" style="padding: 5px; border-radius: 5px; border: 1px solid #ddd;">
                                            <option value="">Change Status</option>
                                            <option value="pending">Pending</option>
                                            <option value="confirmed">Confirmed</option>
                                            <option value="preparing">Preparing</option>
                                            <option value="out_for_delivery">Out for Delivery</option>
                                            <option value="delivered">Delivered</option>
                                            <option value="cancelled">Cancelled</option>
                                        </select>
                                    </td>
                                </tr>
                            `
                                )
                                .join("")}
                        </tbody>
                    </table>
                `;
            }

            // Render all products in products section
            function renderAllProducts() {
                const container = document.getElementById(
                    "admin-products-list"
                );
                if (!container) return;

                if (allProducts.length === 0) {
                    container.innerHTML =
                        '<div class="empty-state"><h3>No products yet</h3></div>';
                    return;
                }

                container.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allProducts
                                .map(
                                    (product) => `
                                <tr>
                                    <td><img src="${product.image}" alt="${
                                        product.name
                                    }" style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;"></td>
                                    <td>${product.name}</td>
                                    <td>${product.category_name || "N/A"}</td>
                                    <td>à§³${parseFloat(
                                        product.price
                                    ).toLocaleString()}</td>
                                    <td>${product.stock}</td>
                                    <td><span class="status-badge ${
                                        product.is_active
                                            ? "status-confirmed"
                                            : "status-cancelled"
                                    }">${
                                        product.is_active
                                            ? "Active"
                                            : "Inactive"
                                    }</span></td>
                                    <td>
                                        <button class="btn btn-sm" onclick="editProduct(${
                                            product.id
                                        })" style="background: #007bff; color: white;">Edit</button>
                                        <button class="btn btn-sm" onclick="deleteProduct(${
                                            product.id
                                        })" style="background: #dc3545; color: white;">Delete</button>
                                    </td>
                                </tr>
                            `
                                )
                                .join("")}
                        </tbody>
                    </table>
                `;
            }

            // Render all customers
            function renderAllCustomers() {
                const container = document.getElementById(
                    "admin-customers-list"
                );
                if (!container) return;

                if (allCustomers.length === 0) {
                    container.innerHTML =
                        '<div class="empty-state"><h3>No customers yet</h3></div>';
                    return;
                }

                container.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Joined</th>
                                <th>Orders</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allCustomers
                                .map((customer) => {
                                    const customerOrders = allOrders.filter(
                                        (o) => o.user_id == customer.id
                                    );
                                    return `
                                    <tr>
                                        <td>#${customer.id}</td>
                                        <td>${customer.name}</td>
                                        <td>${customer.email}</td>
                                        <td>${customer.phone || "N/A"}</td>
                                        <td>${formatDate(
                                            customer.created_at
                                        )}</td>
                                        <td>${customerOrders.length} orders</td>
                                        <td>
                                            <button class="btn btn-sm" onclick="viewCustomerDetails(${
                                                customer.id
                                            })" style="background: #007bff; color: white;">View</button>
                                        </td>
                                    </tr>
                                `;
                                })
                                .join("")}
                        </tbody>
                    </table>
                `;
            }

            // Update order status
            async function updateOrderStatusAdmin(orderId, newStatus) {
                if (!newStatus) return;

                MoonCart.showLoading();
                try {
                    const response = await MoonCartAPI.updateOrderStatus(
                        orderId,
                        newStatus
                    );
                    MoonCart.hideLoading();

                    if (response.success) {
                        MoonCart.showNotification(
                            "Order status updated to " + newStatus,
                            "success"
                        );
                        // Reload orders
                        await loadDashboardOrders();
                        updateDashboardStats();
                        renderRecentOrders();
                        renderAllOrders();
                    } else {
                        MoonCart.showNotification(
                            response.message || "Failed to update status",
                            "error"
                        );
                    }
                } catch (error) {
                    MoonCart.hideLoading();
                    MoonCart.showNotification(
                        "Failed to update order status",
                        "error"
                    );
                }
            }

            // View order details
            async function viewAdminOrderDetails(orderId) {
                try {
                    const response = await MoonCartAPI.getOrder(orderId);
                    if (response.success && response.order) {
                        const order = response.order;
                        const modal = document.getElementById(
                            "order-details-modal"
                        );
                        const content = document.getElementById(
                            "order-modal-content"
                        );

                        if (modal && content) {
                            content.innerHTML = `
                                <div style="margin-bottom: 25px;">
                                    <h3 style="color: #667eea; margin-bottom: 10px;">Order #${
                                        order.order_number || order.id
                                    }</h3>
                                    <span class="status-badge status-${
                                        order.status
                                    }" style="padding: 6px 12px; font-size: 12px;">${
                                order.status
                            }</span>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
                                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                        <h4 style="color: #667eea; margin-bottom: 15px;"><i class="fas fa-user"></i> Customer Info</h4>
                                        <p style="margin: 8px 0;"><strong>Name:</strong> ${
                                            order.customer_name
                                        }</p>
                                        <p style="margin: 8px 0;"><strong>Email:</strong> ${
                                            order.email
                                        }</p>
                                        <p style="margin: 8px 0;"><strong>Phone:</strong> ${
                                            order.phone
                                        }</p>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                        <h4 style="color: #667eea; margin-bottom: 15px;"><i class="fas fa-map-marker-alt"></i> Delivery Info</h4>
                                        <p style="margin: 8px 0;"><strong>Address:</strong> ${
                                            order.address
                                        }</p>
                                        <p style="margin: 8px 0;"><strong>City:</strong> ${
                                            order.city
                                        }</p>
                                        <p style="margin: 8px 0;"><strong>Slot:</strong> ${
                                            order.delivery_slot || "N/A"
                                        }</p>
                                    </div>
                                </div>
                                <h4 style="color: #667eea; margin-bottom: 15px;"><i class="fas fa-shopping-cart"></i> Order Items</h4>
                                <table class="data-table" style="margin-top: 10px; width: 100%;">
                                    <thead>
                                        <tr style="background: #f8f9fa;">
                                            <th style="padding: 12px; text-align: left;">Product</th>
                                            <th style="padding: 12px; text-align: center;">Qty</th>
                                            <th style="padding: 12px; text-align: right;">Price</th>
                                            <th style="padding: 12px; text-align: right;">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${(order.items || [])
                                            .map(
                                                (item) => `
                                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                                <td style="padding: 12px;">${
                                                    item.product_name
                                                }</td>
                                                <td style="padding: 12px; text-align: center;">${
                                                    item.quantity
                                                }</td>
                                                <td style="padding: 12px; text-align: right;">à§³${parseFloat(
                                                    item.price
                                                ).toLocaleString()}</td>
                                                <td style="padding: 12px; text-align: right; font-weight: 600;">à§³${parseFloat(
                                                    item.total
                                                ).toLocaleString()}</td>
                                            </tr>
                                        `
                                            )
                                            .join("")}
                                    </tbody>
                                </table>
                                <div style="margin-top: 25px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span style="color: #666;">Subtotal:</span>
                                        <span style="font-weight: 600;">à§³${parseFloat(
                                            order.subtotal
                                        ).toLocaleString()}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span style="color: #666;">Tax:</span>
                                        <span style="font-weight: 600;">à§³${parseFloat(
                                            order.tax
                                        ).toLocaleString()}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid #ddd;">
                                        <span style="color: #666;">Shipping:</span>
                                        <span style="font-weight: 600;">${
                                            order.shipping == 0
                                                ? '<span style="color: #28a745;">FREE</span>'
                                                : "à§³" +
                                                  parseFloat(
                                                      order.shipping
                                                  ).toLocaleString()
                                        }</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-size: 18px; font-weight: 700; color: #333;">Total:</span>
                                        <span style="font-size: 20px; font-weight: 700; color: #667eea;">à§³${parseFloat(
                                            order.total
                                        ).toLocaleString()}</span>
                                    </div>
                                </div>
                            `;
                            modal.classList.add("active");
                        }
                    }
                } catch (error) {
                    MoonCart.showNotification(
                        "Failed to load order details",
                        "error"
                    );
                }
            }

            // View customer details
            function viewCustomerDetails(customerId) {
                const customer = allCustomers.find((c) => c.id == customerId);
                if (!customer) {
                    MoonCart.showNotification("Customer not found", "error");
                    return;
                }

                const customerOrders = allOrders.filter(
                    (o) => o.user_id == customerId
                );
                const totalSpent = customerOrders.reduce(
                    (sum, o) => sum + parseFloat(o.total || 0),
                    0
                );

                const content = document.getElementById(
                    "customer-details-content"
                );
                if (!content) return;

                content.innerHTML = `
                    <!-- Customer Info Card -->
                    <div style="background: linear-gradient(135deg, rgba(48, 207, 208, 0.1) 0%, rgba(51, 8, 103, 0.1) 100%); padding: 25px; border-radius: 12px; margin-bottom: 30px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div>
                                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">Customer Name</div>
                                <div style="font-size: 18px; font-weight: 600; color: #333;"><i class="fas fa-user"></i> ${
                                    customer.name
                                }</div>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">Email</div>
                                <div style="font-size: 16px; font-weight: 600; color: #333;"><i class="fas fa-envelope"></i> ${
                                    customer.email
                                }</div>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">Phone</div>
                                <div style="font-size: 16px; font-weight: 600; color: #333;"><i class="fas fa-phone"></i> ${
                                    customer.phone || "N/A"
                                }</div>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">Member Since</div>
                                <div style="font-size: 16px; font-weight: 600; color: #333;"><i class="fas fa-calendar"></i> ${formatDate(
                                    customer.created_at
                                )}</div>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">Total Orders</div>
                                <div style="font-size: 18px; font-weight: 700; color: #30cfd0;">${
                                    customerOrders.length
                                }</div>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 13px; margin-bottom: 5px;">Total Spent</div>
                                <div style="font-size: 18px; font-weight: 700; color: #30cfd0;">à§³${MoonCart.formatCurrency(
                                    totalSpent
                                )}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Orders Table -->
                    <h3 style="margin-bottom: 20px; color: #333;"><i class="fas fa-shopping-bag"></i> Order History</h3>
                    ${
                        customerOrders.length === 0
                            ? `
                        <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px;">
                            <i class="fas fa-shopping-cart" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
                            <p style="color: #999; font-size: 16px;">No orders yet</p>
                        </div>
                    `
                            : `
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Order #</th>
                                        <th>Date</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${customerOrders
                                        .map(
                                            (order) => `
                                        <tr>
                                            <td style="font-weight: 600;">#${String(
                                                order.order_number || order.id
                                            )
                                                .substring(0, 12)
                                                .toUpperCase()}</td>
                                            <td>${formatDate(
                                                order.created_at
                                            )}</td>
                                            <td>${
                                                order.item_count ||
                                                order.items?.length ||
                                                0
                                            } items</td>
                                            <td style="font-weight: 600; color: #30cfd0;">à§³${MoonCart.formatCurrency(
                                                parseFloat(order.total)
                                            )}</td>
                                            <td><span class="status-badge status-${
                                                order.status
                                            }">${order.status}</span></td>
                                            <td>
                                                <button class="btn btn-sm" onclick="viewOrderFromCustomerModal('${
                                                    order.id
                                                }')" style="background: #007bff; color: white; padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                                    <i class="fas fa-eye"></i> View
                                                </button>
                                            </td>
                                        </tr>
                                    `
                                        )
                                        .join("")}
                                </tbody>
                            </table>
                        </div>
                    `
                    }
                `;

                document
                    .getElementById("customer-details-modal")
                    .classList.add("active");
            }

            function closeCustomerDetailsModal() {
                document
                    .getElementById("customer-details-modal")
                    .classList.remove("active");
            }

            // View order details from customer modal
            async function viewOrderFromCustomerModal(orderId) {
                closeCustomerDetailsModal();
                await viewAdminOrderDetails(orderId);
            }

            // Edit product (placeholder)
            let currentEditingProductId = null;

            async function editProduct(productId) {
                currentEditingProductId = productId;

                // Load product data from backend
                try {
                    const response = await MoonCartAPI.getProduct(productId);
                    if (response.success && response.product) {
                        const product = response.product;
                        document.getElementById("edit-product-name").value =
                            product.name;
                        document.getElementById("edit-product-price").value =
                            product.price;
                        document.getElementById("edit-product-stock").value =
                            product.stock || 0;

                        // Show modal
                        document
                            .getElementById("edit-product-modal")
                            .classList.add("active");
                    } else {
                        MoonCart.showNotification(
                            "Failed to load product data",
                            "error"
                        );
                    }
                } catch (error) {
                    console.error("Error loading product:", error);
                    MoonCart.showNotification(
                        "Failed to load product data",
                        "error"
                    );
                }
            }

            function closeEditProductModal() {
                document
                    .getElementById("edit-product-modal")
                    .classList.remove("active");
                currentEditingProductId = null;
            }

            async function saveProductChanges() {
                if (!currentEditingProductId) return;

                const price = parseFloat(
                    document.getElementById("edit-product-price").value
                );
                const stock = parseInt(
                    document.getElementById("edit-product-stock").value
                );

                if (!price || price <= 0) {
                    MoonCart.showNotification(
                        "Please enter a valid price",
                        "error"
                    );
                    return;
                }

                if (!stock || stock < 0) {
                    MoonCart.showNotification(
                        "Please enter a valid stock quantity",
                        "error"
                    );
                    return;
                }

                MoonCart.showLoading();
                try {
                    const response = await MoonCartAPI.updateProduct({
                        id: currentEditingProductId,
                        price: price,
                        stock: stock,
                    });

                    MoonCart.hideLoading();

                    if (response.success) {
                        MoonCart.showNotification(
                            "Product updated successfully!",
                            "success"
                        );
                        closeEditProductModal();
                        await loadDashboardProducts();
                        renderAllProducts();
                    } else {
                        MoonCart.showNotification(
                            response.message || "Failed to update product",
                            "error"
                        );
                    }
                } catch (error) {
                    MoonCart.hideLoading();
                    console.error("Error updating product:", error);
                    MoonCart.showNotification(
                        "Failed to update product",
                        "error"
                    );
                }
            }

            // Delete product
            async function deleteProduct(productId) {
                showConfirmModal(
                    "Delete Product",
                    "Are you sure you want to delete this product? This action cannot be undone.",
                    async () => {
                        MoonCart.showLoading();
                        try {
                            const response = await MoonCartAPI.deleteProduct(
                                productId
                            );
                            MoonCart.hideLoading();

                            if (response.success) {
                                MoonCart.showNotification(
                                    "Product deleted",
                                    "success"
                                );
                                await loadDashboardProducts();
                                renderAllProducts();
                            } else {
                                MoonCart.showNotification(
                                    response.message ||
                                        "Failed to delete product",
                                    "error"
                                );
                            }
                        } catch (error) {
                            MoonCart.hideLoading();
                            MoonCart.showNotification(
                                "Failed to delete product",
                                "error"
                            );
                        }
                    }
                );
            }

            // Helper function to format date
            function formatDate(dateStr) {
                if (!dateStr) return "N/A";
                const date = new Date(dateStr);
                return date.toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                });
            }

            // Load orders from backend API (allOrders already declared above)
            async function loadAllOrders() {
                try {
                    const response = await MoonCartAPI.getAllOrders();
                    if (response.success && response.orders) {
                        allOrders = response.orders;
                        localStorage.setItem(
                            "mooncart_orders",
                            JSON.stringify(allOrders)
                        );
                        renderAdminOrders();
                        updateDashboardStats();
                    }
                } catch (error) {
                    console.error(
                        "Could not load orders from backend:",
                        error.message
                    );
                    allOrders = [];
                    renderAdminOrders();
                }
            }

            // Load customers from backend (if not already defined)
            async function loadAllCustomers() {
                try {
                    const response = await MoonCartAPI.getAllUsers("customer");
                    if (response.success && response.users) {
                        allCustomers = response.users;
                    }
                } catch (error) {
                    console.error("Failed to load customers:", error);
                    allCustomers = [];
                }
            }

            function updateDashboardStats() {
                // Update stats based on real data
                const totalOrders = allOrders.length;
                const pendingOrders = allOrders.filter(
                    (o) => o.status === "pending"
                ).length;
                const totalRevenue = allOrders
                    .filter((o) => o.status !== "cancelled")
                    .reduce((sum, o) => sum + parseFloat(o.total || 0), 0);
                const totalCustomers = allCustomers.length;

                // Update stat cards using IDs
                const totalOrdersEl =
                    document.getElementById("stat-total-orders");
                const totalRevenueEl =
                    document.getElementById("stat-total-revenue");
                const pendingOrdersEl = document.getElementById(
                    "stat-pending-orders"
                );
                const totalCustomersEl = document.getElementById(
                    "stat-total-customers"
                );

                if (totalOrdersEl) totalOrdersEl.textContent = totalOrders;
                if (totalRevenueEl)
                    totalRevenueEl.textContent =
                        "à§³" + MoonCart.formatCurrency(totalRevenue);
                if (pendingOrdersEl)
                    pendingOrdersEl.textContent = pendingOrders;
                if (totalCustomersEl)
                    totalCustomersEl.textContent = totalCustomers;
            }

            // Create fallback mock orders for admin (used if backend fails)
            const adminMockOrders = [
                {
                    id: "ORD" + Date.now().toString().slice(-8),
                    customerId: "cust1",
                    customerName: "John Doe",
                    email: "john@example.com",
                    phone: "+880 1234 567890",
                    address: "House 45, Road 12, Bashundhara R/A",
                    city: "Dhaka",
                    zipCode: "1229",
                    deliverySlot: "12:00 AM - 1:00 AM",
                    paymentMethod: "card",
                    items: [
                        {
                            id: "p1",
                            name: "Margherita Pizza",
                            quantity: 2,
                            price: 650,
                            image: "pizza.jpg",
                            category: "food",
                        },
                        {
                            id: "p2",
                            name: "Garlic Bread",
                            quantity: 1,
                            price: 250,
                            image: "bread.jpg",
                            category: "food",
                        },
                    ],
                    orderDate: new Date(Date.now() - 3600000).toISOString(),
                    status: "pending",
                    subtotal: 1550,
                    tax: 155,
                    shipping: 0,
                    total: 1705,
                    itemCount: 3,
                },
                {
                    id: "ORD" + (Date.now() - 1000).toString().slice(-8),
                    customerId: "cust2",
                    customerName: "Sarah Ahmed",
                    email: "sarah@example.com",
                    phone: "+880 1712 345678",
                    address: "Flat 7B, Block C, Bashundhara R/A",
                    city: "Dhaka",
                    zipCode: "1229",
                    deliverySlot: "1:00 AM - 2:00 AM",
                    paymentMethod: "card",
                    items: [
                        {
                            id: "p3",
                            name: "Chicken Burger",
                            quantity: 1,
                            price: 450,
                            image: "burger.jpg",
                            category: "food",
                        },
                        {
                            id: "p4",
                            name: "French Fries",
                            quantity: 2,
                            price: 200,
                            image: "fries.jpg",
                            category: "food",
                        },
                    ],
                    orderDate: new Date(Date.now() - 7200000).toISOString(),
                    status: "confirmed",
                    subtotal: 850,
                    tax: 85,
                    shipping: 50,
                    total: 985,
                    itemCount: 3,
                    deliveryPersonId: "delivery1",
                },
                {
                    id: "ORD" + (Date.now() - 2000).toString().slice(-8),
                    customerId: "cust3",
                    customerName: "Karim Rahman",
                    email: "karim@example.com",
                    phone: "+880 1987 654321",
                    address: "House 23, Road 8, Bashundhara R/A",
                    city: "Dhaka",
                    zipCode: "1229",
                    deliverySlot: "2:00 AM - 3:00 AM",
                    paymentMethod: "card",
                    items: [
                        {
                            id: "p5",
                            name: "Pasta Alfredo",
                            quantity: 1,
                            price: 750,
                            image: "pasta.jpg",
                            category: "food",
                        },
                    ],
                    orderDate: new Date(Date.now() - 86400000).toISOString(),
                    status: "delivered",
                    subtotal: 750,
                    tax: 75,
                    shipping: 50,
                    total: 875,
                    itemCount: 1,
                },
                {
                    id: "ORD" + (Date.now() - 3000).toString().slice(-8),
                    customerId: "cust4",
                    customerName: "Fatima Khan",
                    email: "fatima@example.com",
                    phone: "+880 1556 789012",
                    address: "Flat 12C, Block F, Bashundhara R/A",
                    city: "Dhaka",
                    zipCode: "1229",
                    deliverySlot: "3:00 AM - 4:00 AM",
                    paymentMethod: "card",
                    items: [
                        {
                            id: "p6",
                            name: "Sushi Roll Set",
                            quantity: 1,
                            price: 1250,
                            image: "sushi.jpg",
                            category: "food",
                        },
                        {
                            id: "p7",
                            name: "Miso Soup",
                            quantity: 2,
                            price: 200,
                            image: "soup.jpg",
                            category: "food",
                        },
                    ],
                    orderDate: new Date(Date.now() - 10800000).toISOString(),
                    status: "out_for_delivery",
                    subtotal: 1650,
                    tax: 165,
                    shipping: 0,
                    total: 1815,
                    itemCount: 3,
                    deliveryPersonId: "delivery2",
                },
                {
                    id: "ORD" + (Date.now() - 4000).toString().slice(-8),
                    customerId: "cust5",
                    customerName: "Ahmed Hossain",
                    email: "ahmed@example.com",
                    phone: "+880 1823 456789",
                    address: "House 78, Road 15, Bashundhara R/A",
                    city: "Dhaka",
                    zipCode: "1229",
                    deliverySlot: "12:00 AM - 1:00 AM",
                    paymentMethod: "card",
                    items: [
                        {
                            id: "p8",
                            name: "Pain Relief Medicine",
                            quantity: 1,
                            price: 450,
                            image: "medicine.jpg",
                            category: "medicine",
                        },
                    ],
                    orderDate: new Date(Date.now() - 1800000).toISOString(),
                    status: "pending",
                    subtotal: 450,
                    tax: 45,
                    shipping: 0,
                    total: 495,
                    itemCount: 1,
                },
            ];

            // Save mock orders
            localStorage.setItem(
                "mooncart_orders",
                JSON.stringify(adminMockOrders)
            );

            // Load orders on page load
            document.addEventListener("DOMContentLoaded", async function () {
                // Try to load orders and customers from backend first
                try {
                    await Promise.all([loadAllOrders(), loadAllCustomers()]);

                    // Update stats with real data
                    updateDashboardStats();

                    renderAdminOrdersCustom();
                    // Also render in the full orders section
                    setTimeout(() => {
                        const fullSection =
                            document.getElementById("admin-orders-full");
                        if (fullSection) {
                            fullSection.innerHTML =
                                '<div id="admin-orders-full2"></div>';
                            displayAllAdminOrders();
                        }
                    }, 100);
                } catch (error) {
                    console.error("Failed to load dashboard data:", error);
                    // Fallback to local rendering
                    renderAdminOrdersCustom();
                }
            });

            // Custom render function for admin orders with colored buttons
            function renderAdminOrdersCustom() {
                // Use allOrders from backend instead of localStorage
                const orders = allOrders || [];
                const container = document.getElementById("admin-orders");

                if (!container) return;

                if (orders.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No orders yet</h3>
                            <p>Orders will appear here once customers start placing them.</p>
                        </div>
                    `;
                    return;
                }

                // Sort by created_at (backend field) or orderDate (fallback)
                orders.sort((a, b) => {
                    const dateA = new Date(a.created_at || a.orderDate || 0);
                    const dateB = new Date(b.created_at || b.orderDate || 0);
                    return dateB - dateA;
                });
                const recentOrders = orders.slice(0, 5);

                container.innerHTML = `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recentOrders
                                .map((order) => {
                                    const orderId = String(
                                        order.id || order.order_number || ""
                                    );
                                    const orderNumber =
                                        order.order_number || orderId;
                                    return `
                                <tr>
                                    <td>#${String(orderNumber)
                                        .substring(0, 12)
                                        .toUpperCase()}</td>
                                    <td>${
                                        order.customer_name ||
                                        order.customerName ||
                                        "N/A"
                                    }</td>
                                    <td>${formatDate(
                                        order.created_at || order.orderDate
                                    )}</td>
                                    <td>${
                                        order.item_count ||
                                        order.items?.length ||
                                        0
                                    } items</td>
                                    <td>${MoonCart.formatCurrency(
                                        parseFloat(order.total || 0)
                                    )}</td>
                                    <td><span class="status-badge status-${
                                        order.status
                                    }">${order.status}</span></td>
                                    <td style="white-space: nowrap;">
                                        <button class="btn btn-sm" onclick="viewAdminOrderDetails('${
                                            order.id
                                        }')" style="background: #007bff; color: white; border: none; margin-right: 5px;">View</button>
                                        ${
                                            order.status === "pending"
                                                ? `
                                            <button class="btn btn-sm" onclick="acceptOrder('${order.id}')" style="background: #28a745; color: white; border: none; margin-right: 5px;">Accept</button>
                                            <button class="btn btn-sm" onclick="showDeclineModal('${order.id}')" style="background: #dc3545; color: white; border: none;">Decline</button>
                                        `
                                                : ""
                                        }
                                        ${
                                            order.status === "confirmed"
                                                ? `
                                            <button class="btn btn-sm" onclick="showAssignModal('${order.id}')" style="background: #ff8c00; color: white; border: none;">Assign</button>
                                        `
                                                : ""
                                        }
                                    </td>
                                </tr>
                            `;
                                })
                                .join("")}
                        </tbody>
                    </table>
                `;
            }

            // Display all admin orders
            function displayAllAdminOrders() {
                displayFilteredAdminOrders(allOrders);
            }

            // viewAdminOrderDetails is already defined above using API (line 1235) - removed duplicate localStorage version

            // Accept order and refresh display
            async function acceptOrder(orderId) {
                await updateOrderStatusAdmin(orderId, "confirmed");
            }

            // Show decline modal
            let currentDecliningOrderId = null;

            async function showDeclineModal(orderId) {
                currentDecliningOrderId = orderId;
                document.getElementById("decline-reason").value = "";
                document
                    .getElementById("decline-order-modal")
                    .classList.add("active");
            }

            function closeDeclineModal() {
                document
                    .getElementById("decline-order-modal")
                    .classList.remove("active");
                currentDecliningOrderId = null;
            }

            async function confirmDeclineOrder() {
                const reason = document
                    .getElementById("decline-reason")
                    .value.trim();

                if (!reason) {
                    MoonCart.showNotification(
                        "Please provide a reason for declining",
                        "error"
                    );
                    return;
                }

                if (currentDecliningOrderId) {
                    closeDeclineModal();
                    await updateOrderStatusAdmin(
                        currentDecliningOrderId,
                        "cancelled"
                    );
                }
            }

            // Show assign modal
            let currentAssigningOrderId = null;
            let selectedDeliveryPerson = null;

            async function showAssignModal(orderId) {
                currentAssigningOrderId = orderId;
                selectedDeliveryPerson = null;

                const deliveryPersons = [
                    {
                        id: "delivery1",
                        name: "Mike Johnson",
                        rating: "4.8",
                        orders: "156",
                    },
                    {
                        id: "delivery2",
                        name: "Sarah Wilson",
                        rating: "4.9",
                        orders: "203",
                    },
                    {
                        id: "delivery3",
                        name: "Ahmed Hassan",
                        rating: "4.7",
                        orders: "142",
                    },
                ];

                const listHtml = deliveryPersons
                    .map(
                        (person) => `
                    <div class="delivery-person-item" onclick="selectDeliveryPerson('${
                        person.id
                    }', '${person.name}')" id="person-${person.id}">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; font-weight: bold;">
                                ${person.name
                                    .split(" ")
                                    .map((n) => n[0])
                                    .join("")}
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #333; margin-bottom: 4px;">${
                                    person.name
                                }</div>
                                <div style="font-size: 13px; color: #666;">
                                    <i class="fas fa-star" style="color: #ffc107;"></i> ${
                                        person.rating
                                    } â¢ ${person.orders} deliveries
                                </div>
                            </div>
                            <i class="fas fa-check-circle" style="font-size: 24px; color: #30cfd0; opacity: 0;" id="check-${
                                person.id
                            }"></i>
                        </div>
                    </div>
                `
                    )
                    .join("");

                document.getElementById("delivery-person-list").innerHTML =
                    listHtml;
                document
                    .getElementById("assign-delivery-modal")
                    .classList.add("active");
            }

            function selectDeliveryPerson(id, name) {
                selectedDeliveryPerson = { id, name };

                // Remove selection from all
                document
                    .querySelectorAll(".delivery-person-item")
                    .forEach((item) => {
                        item.classList.remove("selected");
                    });
                document.querySelectorAll('[id^="check-"]').forEach((check) => {
                    check.style.opacity = "0";
                });

                // Add selection to clicked
                document
                    .getElementById(`person-${id}`)
                    .classList.add("selected");
                document.getElementById(`check-${id}`).style.opacity = "1";
            }

            function closeAssignModal() {
                document
                    .getElementById("assign-delivery-modal")
                    .classList.remove("active");
                currentAssigningOrderId = null;
                selectedDeliveryPerson = null;
            }

            async function confirmAssignDelivery() {
                if (!selectedDeliveryPerson) {
                    MoonCart.showNotification(
                        "Please select a delivery person",
                        "error"
                    );
                    return;
                }

                if (currentAssigningOrderId) {
                    closeAssignModal();
                    await updateOrderStatusAdmin(
                        currentAssigningOrderId,
                        "out_for_delivery"
                    );
                    MoonCart.showNotification(
                        `Order assigned to ${selectedDeliveryPerson.name}. GPS tracking enabled.`,
                        "success"
                    );
                }
            }

            // showSection function is already defined above in global scope

            // Customer Management Functions
            let allCustomersData = [];
            let allOrdersData = [];
            let currentCustomerId = null;

            async function loadCustomersData() {
                try {
                    const usersResponse = await MoonCartAPI.getAllUsers(
                        "customer"
                    );
                    if (usersResponse.success && usersResponse.users) {
                        allCustomersData = usersResponse.users;
                    }
                    const ordersResponse = await MoonCartAPI.getAllOrders();
                    if (ordersResponse.success && ordersResponse.orders) {
                        allOrdersData = ordersResponse.orders;
                    }
                    renderCustomersTable();
                } catch (error) {
                    console.error("Error loading customers:", error);
                }
            }

            function getCustomerStats(customerId) {
                const customerOrders = allOrdersData.filter(
                    (o) => o.user_id == customerId
                );
                const totalSpent = customerOrders.reduce(
                    (sum, o) => sum + parseFloat(o.total || 0),
                    0
                );
                return { orderCount: customerOrders.length, totalSpent };
            }

            function renderCustomersTable() {
                const tbody = document.getElementById("customers-tbody");
                if (!tbody) return;

                if (allCustomersData.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; padding: 60px; color: #999;"><i class="fas fa-users" style="font-size: 48px; display: block; margin-bottom: 15px;"></i>No customers found</td></tr>`;
                    return;
                }

                tbody.innerHTML = allCustomersData
                    .map((customer) => {
                        const stats = getCustomerStats(customer.id);
                        const initials = customer.name
                            .split(" ")
                            .map((n) => n[0])
                            .join("")
                            .toUpperCase();
                        return `
                        <tr style="transition: all 0.2s ease;">
                            <td style="padding: 18px 15px; border-bottom: 1px solid #f0f0f0;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px; flex-shrink: 0;">${initials}</div>
                                    <div>
                                        <h4 style="margin: 0; font-size: 15px; font-weight: 600; color: #333;">${
                                            customer.name
                                        }</h4>
                                        <p style="margin: 3px 0 0 0; font-size: 13px; color: #666;"><i class="fas fa-phone"></i> ${
                                            customer.phone || "N/A"
                                        }</p>
                                    </div>
                                </div>
                            </td>
                            <td style="padding: 18px 15px; border-bottom: 1px solid #f0f0f0; color: #333;">${
                                customer.email
                            }</td>
                            <td style="padding: 18px 15px; border-bottom: 1px solid #f0f0f0; font-weight: 600; color: #30cfd0; font-size: 16px;">à§³${MoonCart.formatCurrency(
                                stats.totalSpent
                            )}</td>
                            <td style="padding: 18px 15px; border-bottom: 1px solid #f0f0f0; text-align: center; font-weight: 600; font-size: 16px;">${
                                stats.orderCount
                            }</td>
                            <td style="padding: 18px 15px; border-bottom: 1px solid #f0f0f0;">
                                <button onclick="viewCustomerProfile('${
                                    customer.id
                                }')" style="padding: 10px 20px; border: none; border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.3s ease; margin-right: 8px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white;"><i class="fas fa-user"></i> View Profile</button>
                                <button onclick="viewCustomerOrders('${
                                    customer.id
                                }')" style="padding: 10px 20px; border: none; border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.3s ease; background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); color: white;"><i class="fas fa-shopping-bag"></i> View Orders</button>
                            </td>
                        </tr>
                    `;
                    })
                    .join("");
            }

            function searchCustomers() {
                const searchTerm =
                    document
                        .getElementById("customer-search-input")
                        ?.value.toLowerCase() || "";
                const filtered = allCustomersData.filter(
                    (customer) =>
                        customer.name.toLowerCase().includes(searchTerm) ||
                        customer.email.toLowerCase().includes(searchTerm) ||
                        (customer.phone && customer.phone.includes(searchTerm))
                );
                const tbody = document.getElementById("customers-tbody");
                if (!tbody) return;
                if (filtered.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; padding: 60px; color: #999;">No customers found</td></tr>`;
                    return;
                }
                const originalData = allCustomersData;
                allCustomersData = filtered;
                renderCustomersTable();
                allCustomersData = originalData;
            }

            function viewCustomerProfile(customerId) {
                const customer = allCustomersData.find(
                    (c) => c.id == customerId
                );
                if (!customer) return;
                const stats = getCustomerStats(customerId);
                const initials = customer.name
                    .split(" ")
                    .map((n) => n[0])
                    .join("")
                    .toUpperCase();
                const memberSince = new Date(
                    customer.created_at
                ).toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                });
                document.getElementById("profile-modal-body").innerHTML = `
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 25px; align-items: start; margin-bottom: 30px;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 40px; font-weight: 700; box-shadow: 0 5px 20px rgba(48, 207, 208, 0.3);">${initials}</div>
                        <div>
                            <h3 style="margin: 0 0 8px 0; font-size: 26px; color: #333;">${
                                customer.name
                            }</h3>
                            <p style="margin: 5px 0; color: #666; font-size: 15px;"><i class="fas fa-envelope" style="color: #30cfd0; margin-right: 8px; width: 20px;"></i>${
                                customer.email
                            }</p>
                            <p style="margin: 5px 0; color: #666; font-size: 15px;"><i class="fas fa-phone" style="color: #30cfd0; margin-right: 8px; width: 20px;"></i>${
                                customer.phone || "N/A"
                            }</p>
                            <p style="margin: 5px 0; color: #666; font-size: 15px;"><i class="fas fa-calendar" style="color: #30cfd0; margin-right: 8px; width: 20px;"></i>Member since ${memberSince}</p>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 25px;">
                        <div style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); padding: 20px; border-radius: 12px; text-align: center; color: white;">
                            <h4 style="margin: 0 0 5px 0; font-size: 28px; font-weight: 700;">${
                                stats.orderCount
                            }</h4>
                            <p style="margin: 0; font-size: 13px; opacity: 0.9;">Total Orders</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); padding: 20px; border-radius: 12px; text-align: center; color: white;">
                            <h4 style="margin: 0 0 5px 0; font-size: 28px; font-weight: 700;">à§³${MoonCart.formatCurrency(
                                stats.totalSpent
                            )}</h4>
                            <p style="margin: 0; font-size: 13px; opacity: 0.9;">Total Spent</p>
                        </div>
                    </div>
                `;
                document.getElementById("profile-modal").style.display = "flex";
            }

            function closeProfileModal() {
                document.getElementById("profile-modal").style.display = "none";
            }

            function viewCustomerOrders(customerId) {
                currentCustomerId = customerId;
                const customer = allCustomersData.find(
                    (c) => c.id == customerId
                );
                if (!customer) return;
                const customerOrders = allOrdersData.filter(
                    (o) => o.user_id == customerId
                );
                const modalBody = document.getElementById("orders-modal-body");
                if (customerOrders.length === 0) {
                    modalBody.innerHTML = `<div style="text-align: center; padding: 60px 20px; color: #999;"><i class="fas fa-shopping-cart" style="font-size: 60px; display: block; margin-bottom: 15px; opacity: 0.5;"></i><h3>No orders yet</h3><p>${customer.name} hasn't placed any orders.</p></div>`;
                } else {
                    modalBody.innerHTML = customerOrders
                        .map(
                            (order) => `
                        <div style="border: 2px solid #f0f0f0; border-radius: 12px; margin-bottom: 15px; overflow: hidden; transition: all 0.3s ease;" onmouseover="this.style.borderColor='var(--primary-color)'; this.style.boxShadow='0 3px 10px rgba(227, 30, 36, 0.2)';" onmouseout="this.style.borderColor='#f0f0f0'; this.style.boxShadow='none';">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 18px 20px; background: #f8f9fa; cursor: pointer;" onclick="toggleOrderDetails('${
                                order.id
                            }')">
                                <div>
                                    <h4 style="margin: 0 0 5px 0; font-size: 16px; font-weight: 700; color: var(--primary-color);">#${String(
                                        order.order_number || order.id
                                    )
                                        .substring(0, 12)
                                        .toUpperCase()}</h4>
                                    <p style="margin: 0; font-size: 13px; color: #666;"><i class="fas fa-calendar"></i> ${new Date(
                                        order.created_at
                                    ).toLocaleDateString()} | ${
                                order.item_count || order.items?.length || 0
                            } items</p>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 20px; font-weight: 700; color: #30cfd0; margin-bottom: 5px;">à§³${MoonCart.formatCurrency(
                                        parseFloat(order.total)
                                    )}</div>
                                    <span class="status-badge status-${
                                        order.status
                                    }" style="padding: 6px 14px; border-radius: 15px; font-size: 12px; font-weight: 600; text-transform: capitalize; background: ${
                                order.status === "pending"
                                    ? "#fff3cd"
                                    : order.status === "confirmed"
                                    ? "#d1ecf1"
                                    : order.status === "delivered"
                                    ? "#d4edda"
                                    : "#f8d7da"
                            }; color: ${
                                order.status === "pending"
                                    ? "#856404"
                                    : order.status === "confirmed"
                                    ? "#0c5460"
                                    : order.status === "delivered"
                                    ? "#155724"
                                    : "#721c24"
                            };">${order.status}</span>
                                </div>
                            </div>
                            <div id="order-details-${
                                order.id
                            }" style="display: none; padding: 20px; background: white; border-top: 2px solid #f0f0f0;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                    <div>
                                        <h5 style="margin: 0 0 10px 0; color: var(--primary-color); font-size: 14px; font-weight: 600;"><i class="fas fa-user"></i> CUSTOMER INFO</h5>
                                        <p style="margin: 5px 0; font-size: 14px; color: #666;"><strong>Name:</strong> ${
                                            order.customer_name
                                        }</p>
                                        <p style="margin: 5px 0; font-size: 14px; color: #666;"><strong>Email:</strong> ${
                                            order.email
                                        }</p>
                                        <p style="margin: 5px 0; font-size: 14px; color: #666;"><strong>Phone:</strong> ${
                                            order.phone
                                        }</p>
                                    </div>
                                    <div>
                                        <h5 style="margin: 0 0 10px 0; color: var(--primary-color); font-size: 14px; font-weight: 600;"><i class="fas fa-map-marker-alt"></i> DELIVERY INFO</h5>
                                        <p style="margin: 5px 0; font-size: 14px; color: #666;"><strong>Address:</strong> ${
                                            order.address
                                        }</p>
                                        <p style="margin: 5px 0; font-size: 14px; color: #666;"><strong>City:</strong> ${
                                            order.city
                                        }</p>
                                        <p style="margin: 5px 0; font-size: 14px; color: #666;"><strong>Payment:</strong> ${
                                            order.payment_method || "N/A"
                                        }</p>
                                    </div>
                                </div>
                                <h5 style="margin: 20px 0 10px 0; color: #667eea;"><i class="fas fa-box"></i> ORDER ITEMS</h5>
                                <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                    <thead>
                                        <tr style="background: #f8f9fa;">
                                            <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #333; border-bottom: 2px solid #e0e0e0;">Product</th>
                                            <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #333; border-bottom: 2px solid #e0e0e0;">Quantity</th>
                                            <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #333; border-bottom: 2px solid #e0e0e0;">Price</th>
                                            <th style="padding: 12px; text-align: left; font-size: 13px; font-weight: 600; color: #333; border-bottom: 2px solid #e0e0e0;">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${(order.items || [])
                                            .map(
                                                (item) => `
                                            <tr>
                                                <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 14px; color: #666;">${
                                                    item.product_name
                                                }</td>
                                                <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 14px; color: #666;">${
                                                    item.quantity
                                                }</td>
                                                <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 14px; color: #666;">à§³${MoonCart.formatCurrency(
                                                    parseFloat(item.price)
                                                )}</td>
                                                <td style="padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 14px; color: #666;">à§³${MoonCart.formatCurrency(
                                                    parseFloat(item.total)
                                                )}</td>
                                            </tr>
                                        `
                                            )
                                            .join("")}
                                    </tbody>
                                </table>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 15px;"><span>Subtotal:</span><span>à§³${MoonCart.formatCurrency(
                                        parseFloat(order.subtotal)
                                    )}</span></div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 15px;"><span>Tax:</span><span>à§³${MoonCart.formatCurrency(
                                        parseFloat(order.tax)
                                    )}</span></div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 15px;"><span>Shipping:</span><span>${
                                        order.shipping == 0
                                            ? '<span style="color: #28a745;">FREE</span>'
                                            : "à§³" +
                                              MoonCart.formatCurrency(
                                                  parseFloat(order.shipping)
                                              )
                                    }</span></div>
                                    <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: 700; color: var(--primary-color); padding-top: 10px; border-top: 2px solid #ddd; margin-top: 10px;"><span>Total:</span><span>à§³${MoonCart.formatCurrency(
                                        parseFloat(order.total)
                                    )}</span></div>
                                </div>
                            </div>
                        </div>
                    `
                        )
                        .join("");
                }
                document.getElementById("orders-modal").style.display = "flex";
            }

            function toggleOrderDetails(orderId) {
                const detailsDiv = document.getElementById(
                    `order-details-${orderId}`
                );
                if (detailsDiv) {
                    detailsDiv.style.display =
                        detailsDiv.style.display === "none" ? "block" : "none";
                }
            }

            function closeOrdersModal() {
                document.getElementById("orders-modal").style.display = "none";
            }

            // Delivery Man Management Functions
            let deliveryMenData = [];

            async function loadDeliveryMenData() {
                MoonCart.showLoading();
                try {
                    const response = await MoonCartAPI.getDeliveryMen();
                    if (response.success && response.delivery_men) {
                        deliveryMenData = response.delivery_men;
                        displayDeliveryMen();
                    }
                } catch (error) {
                    console.error("Failed to load delivery men:", error);
                    MoonCart.showNotification(
                        "Failed to load delivery men",
                        "error"
                    );
                    deliveryMenData = [];
                }
                MoonCart.hideLoading();
            }

            function getDeliveryManStats(deliveryManId) {
                if (!deliveryManId)
                    return {
                        activeDeliveries: 0,
                        completedDeliveries: 0,
                        totalDeliveries: 0,
                    };

                const deliveryManOrders = allOrders.filter(
                    (o) => o.delivery_man_id == deliveryManId
                );
                const activeDeliveries = deliveryManOrders.filter(
                    (o) =>
                        o.status === "out_for_delivery" ||
                        o.status === "confirmed"
                ).length;
                const completedDeliveries = deliveryManOrders.filter(
                    (o) => o.status === "delivered"
                ).length;
                const totalDeliveries = deliveryManOrders.length;

                return {
                    activeDeliveries,
                    completedDeliveries,
                    totalDeliveries,
                };
            }

            function displayDeliveryMen() {
                const container = document.getElementById(
                    "delivery-men-container"
                );
                if (!container) return;

                if (deliveryMenData.length === 0) {
                    container.innerHTML = `<div style="text-align: center; padding: 60px 20px; background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);"><i class="fas fa-truck" style="font-size: 80px; color: #ddd; margin-bottom: 20px;"></i><h3 style="color: var(--text-light);">No delivery men found</h3><p>Click "Add Delivery Man" to get started</p></div>`;
                    return;
                }

                container.innerHTML = `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px;">
                    ${deliveryMenData
                        .map((dm) => {
                            const initial = dm.name.charAt(0).toUpperCase();
                            const avatar = dm.profile_image
                                ? `<img src="${dm.profile_image}" alt="${dm.name}" style="width: 100%; height: 100%; object-fit: cover;" />`
                                : initial;
                            const stats = getDeliveryManStats(dm.id);

                            return `
                            <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08); transition: all 0.3s ease; position: relative;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0, 0, 0, 0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 20px rgba(0, 0, 0, 0.08)';">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                    <div style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 24px; overflow: hidden;">${avatar}</div>
                                    <div style="flex: 1;">
                                        <h3 style="margin: 0; font-size: 18px; color: var(--text-dark);">${
                                            dm.name
                                        }</h3>
                                        <p style="margin: 5px 0 0; font-size: 13px; color: var(--text-light);">
                                            <span style="display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; background: ${
                                                dm.is_active
                                                    ? "#d4edda"
                                                    : "#f8d7da"
                                            }; color: ${
                                dm.is_active ? "#155724" : "#721c24"
                            };">${dm.is_active ? "Active" : "Inactive"}</span>
                                        </p>
                                    </div>
                                </div>
                                
                                <!-- Delivery Statistics -->
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 24px; font-weight: 700; color: var(--primary-color);">${
                                            stats.activeDeliveries
                                        }</div>
                                        <div style="font-size: 11px; color: var(--text-light); text-transform: uppercase; margin-top: 5px;">Active</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 24px; font-weight: 700; color: #28a745;">${
                                            stats.completedDeliveries
                                        }</div>
                                        <div style="font-size: 11px; color: var(--text-light); text-transform: uppercase; margin-top: 5px;">Completed</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 24px; font-weight: 700; color: #007bff;">${
                                            stats.totalDeliveries
                                        }</div>
                                        <div style="font-size: 11px; color: var(--text-light); text-transform: uppercase; margin-top: 5px;">Total</div>
                                    </div>
                                </div>
                                
                                <!-- Contact Info -->
                                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; font-size: 14px;">
                                        <i class="fas fa-phone" style="color: var(--primary-color); width: 20px;"></i>
                                        <span style="color: var(--text-dark);">${
                                            dm.phone
                                        }</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
                                        <i class="fas fa-id-card" style="color: var(--primary-color); width: 20px;"></i>
                                        <span style="color: var(--text-dark);">NID: ${
                                            dm.nid
                                        }</span>
                                    </div>
                                </div>
                                
                                <!-- Actions -->
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="editDeliveryMan(${
                                        dm.id
                                    })" style="flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 13px; background: #007bff; color: white;" onmouseover="this.style.background='#0056b3';" onmouseout="this.style.background='#007bff';"><i class="fas fa-edit"></i> Edit</button>
                                    <button onclick="deleteDeliveryMan(${
                                        dm.id
                                    })" style="flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 13px; background: #dc3545; color: white;" onmouseover="this.style.background='#c82333';" onmouseout="this.style.background='#dc3545';"><i class="fas fa-trash"></i> Delete</button>
                                </div>
                            </div>
                        `;
                        })
                        .join("")}
                </div>`;
            }

            function openAddDeliveryManDialog() {
                document.getElementById("dialog-title").innerHTML =
                    '<i class="fas fa-user-plus"></i> Add Delivery Man';
                document.getElementById("delivery-man-form").reset();
                document.getElementById("delivery-man-id").value = "";
                document.getElementById("delivery-man-status").value = "1";
                document.getElementById("delivery-man-dialog").style.display =
                    "flex";
            }

            function editDeliveryMan(id) {
                const dm = deliveryMenData.find((d) => d.id == id);
                if (!dm) return;
                document.getElementById("dialog-title").innerHTML =
                    '<i class="fas fa-edit"></i> Edit Delivery Man';
                document.getElementById("delivery-man-id").value = dm.id;
                document.getElementById("delivery-man-name").value = dm.name;
                document.getElementById("delivery-man-phone").value = dm.phone;
                document.getElementById("delivery-man-nid").value = dm.nid;
                document.getElementById("delivery-man-image").value =
                    dm.profile_image || "";
                document.getElementById("delivery-man-status").value =
                    dm.is_active ? "1" : "0";
                document.getElementById("delivery-man-dialog").style.display =
                    "flex";
            }

            function closeDeliveryManDialog() {
                document.getElementById("delivery-man-dialog").style.display =
                    "none";
            }

            async function saveDeliveryMan(event) {
                event.preventDefault();
                const id = document.getElementById("delivery-man-id").value;
                const data = {
                    name: document
                        .getElementById("delivery-man-name")
                        .value.trim(),
                    phone: document
                        .getElementById("delivery-man-phone")
                        .value.trim(),
                    nid: document
                        .getElementById("delivery-man-nid")
                        .value.trim(),
                    profile_image:
                        document
                            .getElementById("delivery-man-image")
                            .value.trim() || null,
                    is_active: parseInt(
                        document.getElementById("delivery-man-status").value
                    ),
                };
                if (!data.name || !data.phone || !data.nid) {
                    MoonCart.showNotification(
                        "Please fill all required fields",
                        "error"
                    );
                    return;
                }
                MoonCart.showLoading();
                try {
                    let response;
                    if (id) {
                        data.id = parseInt(id);
                        response = await MoonCartAPI.updateDeliveryMan(data);
                    } else {
                        response = await MoonCartAPI.createDeliveryMan(data);
                    }
                    MoonCart.hideLoading();
                    if (response.success) {
                        MoonCart.showNotification(
                            id
                                ? "Delivery man updated successfully"
                                : "Delivery man added successfully",
                            "success"
                        );
                        closeDeliveryManDialog();
                        await loadDeliveryMenData();
                    } else {
                        MoonCart.showNotification(
                            response.message || "Failed to save delivery man",
                            "error"
                        );
                    }
                } catch (error) {
                    MoonCart.hideLoading();
                    MoonCart.showNotification(
                        "Failed to save delivery man",
                        "error"
                    );
                }
            }

            async function deleteDeliveryMan(id) {
                if (
                    !confirm(
                        "Are you sure you want to delete this delivery man?"
                    )
                )
                    return;
                MoonCart.showLoading();
                try {
                    const response = await MoonCartAPI.deleteDeliveryMan(id);
                    MoonCart.hideLoading();
                    if (response.success) {
                        MoonCart.showNotification(
                            "Delivery man deleted successfully",
                            "success"
                        );
                        await loadDeliveryMenData();
                    } else {
                        MoonCart.showNotification(
                            response.message || "Failed to delete delivery man",
                            "error"
                        );
                    }
                } catch (error) {
                    MoonCart.hideLoading();
                    MoonCart.showNotification(
                        "Failed to delete delivery man",
                        "error"
                    );
                }
            }

            // Close modals on outside click
            window.onclick = function (event) {
                if (event.target.classList.contains("modal")) {
                    event.target.style.display = "none";
                    // Reset forms when closing
                    if (event.target.id === "accept-request-modal") {
                        closeAcceptRequestModal();
                    } else if (event.target.id === "reject-request-modal") {
                        closeRejectRequestModal();
                    } else if (
                        event.target.id === "product-request-view-modal"
                    ) {
                        closeProductRequestViewModal();
                    }
                }
                if (event.target.classList.contains("custom-dialog")) {
                    closeDeliveryManDialog();
                }
            };

            // Load data when customers section is shown
            const originalShowSection = window.showSection;
            window.showSection = function (sectionId, element) {
                originalShowSection(sectionId, element);
                if (
                    sectionId === "customers" &&
                    allCustomersData.length === 0
                ) {
                    loadCustomersData();
                }
                if (sectionId === "delivery") {
                    if (deliveryMenData.length === 0) {
                        loadDeliveryMenData();
                    }
                }
                if (sectionId === "product-requests") {
                    if (productRequestsData.length === 0) {
                        loadProductRequests();
                    }
                }
            };

            // ==========================================
            // PRODUCT REQUESTS MANAGEMENT
            // ==========================================
            let productRequestsData = [];
            let currentRequestId = null;
            let currentFilterStatus = null;

            // Load product requests
            async function loadProductRequests(status = null) {
                try {
                    MoonCart.showLoading();
                    const response = await MoonCartAPI.getProductRequests(
                        status
                    );
                    MoonCart.hideLoading();
                    if (response.success && response.requests) {
                        productRequestsData = response.requests;
                        renderProductRequests();
                    } else {
                        productRequestsData = [];
                        renderProductRequests();
                    }
                } catch (error) {
                    MoonCart.hideLoading();
                    console.error("Failed to load product requests:", error);
                    productRequestsData = [];
                    renderProductRequests();
                }
            }

            // Filter product requests
            function filterProductRequests(status) {
                currentFilterStatus = status;
                // Update active filter button
                document.querySelectorAll('[id^="filter-"]').forEach((btn) => {
                    btn.style.background = "";
                    btn.style.color = "";
                });
                const filterBtn = status
                    ? document.getElementById(`filter-${status}`)
                    : document.getElementById("filter-all");
                if (filterBtn) {
                    filterBtn.style.background = "var(--primary-color)";
                    filterBtn.style.color = "white";
                }
                loadProductRequests(status);
            }

            // Render product requests table
            function renderProductRequests() {
                const container = document.getElementById(
                    "product-requests-container"
                );
                if (!container) return;

                if (productRequestsData.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 60px 20px;">
                            <i class="fas fa-inbox" style="font-size: 64px; color: #ddd; margin-bottom: 20px;"></i>
                            <h3 style="color: var(--text-light); margin-bottom: 10px;">No Product Requests</h3>
                            <p style="color: var(--text-light);">There are no product requests ${
                                currentFilterStatus
                                    ? `with status "${currentFilterStatus}"`
                                    : ""
                            }.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <table class="data-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--primary-color); color: white;">
                                <th style="padding: 15px; text-align: left;">ID</th>
                                <th style="padding: 15px; text-align: left;">Product Name</th>
                                <th style="padding: 15px; text-align: left;">Customer</th>
                                <th style="padding: 15px; text-align: left;">Category</th>
                                <th style="padding: 15px; text-align: left;">Status</th>
                                <th style="padding: 15px; text-align: left;">Date</th>
                                <th style="padding: 15px; text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${productRequestsData
                                .map((req) => {
                                    const statusClass =
                                        req.status === "approved"
                                            ? "status-success"
                                            : req.status === "rejected"
                                            ? "status-danger"
                                            : req.status === "under_review"
                                            ? "status-warning"
                                            : "status-pending";
                                    return `
                                    <tr style="border-bottom: 1px solid #eee;">
                                        <td style="padding: 15px;">#${
                                            req.id
                                        }</td>
                                        <td style="padding: 15px; font-weight: 600;">${
                                            req.product_name || "N/A"
                                        }</td>
                                        <td style="padding: 15px;">${
                                            req.user_name ||
                                            req.email ||
                                            "Guest"
                                        }</td>
                                        <td style="padding: 15px;">${
                                            req.category || "N/A"
                                        }</td>
                                        <td style="padding: 15px;">
                                            <span class="status-badge ${statusClass}">${
                                        req.status
                                    }</span>
                                        </td>
                                        <td style="padding: 15px;">${formatDate(
                                            req.created_at
                                        )}</td>
                                        <td style="padding: 15px; text-align: center;">
                                            <button onclick="viewProductRequest(${
                                                req.id
                                            })" class="btn btn-sm" style="margin-right: 5px;">
                                                <i class="fas fa-eye"></i> View
                                            </button>
                                            ${
                                                req.status === "pending"
                                                    ? `
                                                <button onclick="openAcceptRequestModal(${req.id})" class="btn btn-sm" style="background: #28a745; color: white; margin-right: 5px;">
                                                    <i class="fas fa-check"></i> Accept
                                                </button>
                                                <button onclick="openRejectRequestModal(${req.id})" class="btn btn-sm" style="background: #dc3545; color: white;">
                                                    <i class="fas fa-times"></i> Reject
                                                </button>
                                            `
                                                    : ""
                                            }
                                        </td>
                                    </tr>
                                `;
                                })
                                .join("")}
                        </tbody>
                    </table>
                `;
            }

            // View product request details
            async function viewProductRequest(id) {
                try {
                    MoonCart.showLoading();
                    const response = await MoonCartAPI.request(
                        `product_requests.php?action=single&id=${id}`
                    );
                    MoonCart.hideLoading();
                    if (response.success && response.request) {
                        const req = response.request;
                        const modal = document.getElementById(
                            "product-request-view-modal"
                        );
                        const body = document.getElementById(
                            "product-request-view-body"
                        );

                        const statusClass =
                            req.status === "approved"
                                ? "status-success"
                                : req.status === "rejected"
                                ? "status-danger"
                                : req.status === "under_review"
                                ? "status-warning"
                                : "status-pending";

                        body.innerHTML = `
                            <div style="display: grid; gap: 20px;">
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                    <h3 style="margin: 0 0 15px; color: var(--primary-color);">Request Information</h3>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                        <div>
                                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-light);">Request ID</p>
                                            <p style="margin: 0; font-weight: 600; color: var(--text-dark);">#${
                                                req.id
                                            }</p>
                                        </div>
                                        <div>
                                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-light);">Status</p>
                                            <p style="margin: 0;"><span class="status-badge ${statusClass}">${
                            req.status
                        }</span></p>
                                        </div>
                                        <div>
                                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-light);">Date Submitted</p>
                                            <p style="margin: 0; font-weight: 600; color: var(--text-dark);">${formatDate(
                                                req.created_at
                                            )}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                    <h3 style="margin: 0 0 15px; color: var(--primary-color);">Product Details</h3>
                                    <div style="display: grid; gap: 15px;">
                                        <div>
                                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-light);">Product Name</p>
                                            <p style="margin: 0; font-weight: 600; color: var(--text-dark); font-size: 18px;">${
                                                req.product_name || "N/A"
                                            }</p>
                                        </div>
                                        <div>
                                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-light);">Category</p>
                                            <p style="margin: 0; font-weight: 600; color: var(--text-dark);">${
                                                req.category || "N/A"
                                            }</p>
                                        </div>
                                        <div>
                                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-light);">Description</p>
                                            <p style="margin: 0; color: var(--text-dark); line-height: 1.6;">${
                                                req.description ||
                                                "No description provided"
                                            }</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                                    <h3 style="margin: 0 0 15px; color: var(--primary-color);">Customer Information</h3>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                        <div>
                                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-light);">Name</p>
                                            <p style="margin: 0; font-weight: 600; color: var(--text-dark);">${
                                                req.user_name || "Guest"
                                            }</p>
                                        </div>
                                        <div>
                                            <p style="margin: 5px 0; font-size: 13px; color: var(--text-light);">Email</p>
                                            <p style="margin: 0; font-weight: 600; color: var(--text-dark);">${
                                                req.user_email ||
                                                req.email ||
                                                "N/A"
                                            }</p>
                                        </div>
                                    </div>
                                </div>
                                
                                ${
                                    req.admin_notes
                                        ? `
                                    <div style="background: #fff3cd; padding: 20px; border-radius: 10px; border-left: 4px solid #ffc107;">
                                        <h3 style="margin: 0 0 15px; color: #856404;">Admin Notes</h3>
                                        <p style="margin: 0; color: #856404; line-height: 1.6;">${req.admin_notes}</p>
                                    </div>
                                `
                                        : ""
                                }
                                
                                ${
                                    req.rejection_reason
                                        ? `
                                    <div style="background: #f8d7da; padding: 20px; border-radius: 10px; border-left: 4px solid #dc3545;">
                                        <h3 style="margin: 0 0 15px; color: #721c24;">Rejection Reason</h3>
                                        <p style="margin: 0; color: #721c24; line-height: 1.6;">${req.rejection_reason}</p>
                                    </div>
                                `
                                        : ""
                                }
                                
                                ${
                                    req.delivery_time && req.delivery_man_name
                                        ? `
                                    <div style="background: #d1ecf1; padding: 20px; border-radius: 10px; border-left: 4px solid #17a2b8;">
                                        <h3 style="margin: 0 0 15px; color: #0c5460;">Delivery Information</h3>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                            <div>
                                                <p style="margin: 5px 0; font-size: 13px; color: #0c5460;">Delivery Man</p>
                                                <p style="margin: 0; font-weight: 600; color: #0c5460;">${
                                                    req.delivery_man_name
                                                }</p>
                                            </div>
                                            <div>
                                                <p style="margin: 5px 0; font-size: 13px; color: #0c5460;">Delivery Time</p>
                                                <p style="margin: 0; font-weight: 600; color: #0c5460;">${formatDateTime(
                                                    req.delivery_time
                                                )}</p>
                                            </div>
                                        </div>
                                    </div>
                                `
                                        : ""
                                }
                            </div>
                        `;
                        modal.style.display = "flex";
                    } else {
                        MoonCart.showNotification(
                            "Failed to load request details",
                            "error"
                        );
                    }
                } catch (error) {
                    MoonCart.hideLoading();
                    MoonCart.showNotification(
                        "Failed to load request details",
                        "error"
                    );
                }
            }

            // Close view modal
            function closeProductRequestViewModal() {
                document.getElementById(
                    "product-request-view-modal"
                ).style.display = "none";
            }

            // Open accept request modal
            async function openAcceptRequestModal(id) {
                currentRequestId = id;
                // Load delivery men
                try {
                    const response = await MoonCartAPI.getDeliveryMen(true);
                    const select = document.getElementById(
                        "accept-delivery-man"
                    );
                    select.innerHTML =
                        '<option value="">Select Delivery Man</option>';
                    if (response.success && response.delivery_men) {
                        response.delivery_men.forEach((dm) => {
                            const option = document.createElement("option");
                            option.value = dm.id;
                            option.textContent = `${dm.name} (${dm.phone})`;
                            select.appendChild(option);
                        });
                    }
                } catch (error) {
                    console.error("Failed to load delivery men:", error);
                }
                document.getElementById("accept-request-modal").style.display =
                    "flex";
            }

            // Close accept request modal
            function closeAcceptRequestModal() {
                document.getElementById("accept-request-modal").style.display =
                    "none";
                document.getElementById("accept-request-form").reset();
                currentRequestId = null;
            }

            // Submit accept request
            async function submitAcceptRequest(event) {
                event.preventDefault();
                if (!currentRequestId) return;

                const deliveryTime = document.getElementById(
                    "accept-delivery-time"
                ).value;
                const deliveryManId = document.getElementById(
                    "accept-delivery-man"
                ).value;
                const adminNotes =
                    document.getElementById("accept-admin-notes").value;

                if (!deliveryTime || !deliveryManId) {
                    MoonCart.showNotification(
                        "Please fill all required fields",
                        "error"
                    );
                    return;
                }

                try {
                    MoonCart.showLoading();
                    const response = await MoonCartAPI.request(
                        "product_requests.php",
                        {
                            method: "PUT",
                            body: JSON.stringify({
                                id: currentRequestId,
                                status: "approved",
                                delivery_time: deliveryTime,
                                delivery_man_id: deliveryManId,
                                admin_notes: adminNotes,
                            }),
                        }
                    );
                    MoonCart.hideLoading();

                    if (response.success) {
                        MoonCart.showNotification(
                            "Product request accepted successfully",
                            "success"
                        );
                        closeAcceptRequestModal();
                        await loadProductRequests(currentFilterStatus);
                    } else {
                        MoonCart.showNotification(
                            response.message || "Failed to accept request",
                            "error"
                        );
                    }
                } catch (error) {
                    MoonCart.hideLoading();
                    MoonCart.showNotification(
                        "Failed to accept request",
                        "error"
                    );
                }
            }

            // Open reject request modal
            function openRejectRequestModal(id) {
                currentRequestId = id;
                document.getElementById("reject-request-modal").style.display =
                    "flex";
            }

            // Close reject request modal
            function closeRejectRequestModal() {
                document.getElementById("reject-request-modal").style.display =
                    "none";
                document.getElementById("reject-request-form").reset();
                currentRequestId = null;
            }

            // Submit reject request
            async function submitRejectRequest(event) {
                event.preventDefault();
                if (!currentRequestId) return;

                const reason = document
                    .getElementById("reject-reason")
                    .value.trim();

                if (!reason) {
                    MoonCart.showNotification(
                        "Please provide a rejection reason",
                        "error"
                    );
                    return;
                }

                try {
                    MoonCart.showLoading();
                    const response = await MoonCartAPI.request(
                        "product_requests.php",
                        {
                            method: "PUT",
                            body: JSON.stringify({
                                id: currentRequestId,
                                status: "rejected",
                                rejection_reason: reason,
                            }),
                        }
                    );
                    MoonCart.hideLoading();

                    if (response.success) {
                        MoonCart.showNotification(
                            "Product request rejected successfully",
                            "success"
                        );
                        closeRejectRequestModal();
                        await loadProductRequests(currentFilterStatus);
                    } else {
                        MoonCart.showNotification(
                            response.message || "Failed to reject request",
                            "error"
                        );
                    }
                } catch (error) {
                    MoonCart.hideLoading();
                    MoonCart.showNotification(
                        "Failed to reject request",
                        "error"
                    );
                }
            }

            // Format date helper
            function formatDate(dateStr) {
                if (!dateStr) return "N/A";
                const date = new Date(dateStr);
                return date.toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                });
            }

            // Format date time helper
            function formatDateTime(dateStr) {
                if (!dateStr) return "N/A";
                const date = new Date(dateStr);
                return date.toLocaleString("en-US", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                    hour: "2-digit",
                    minute: "2-digit",
                });
            }

            // Logout function
            function logout() {
                localStorage.removeItem("mooncart_user");
                window.location.href = "index.html";
            }

            // Store chart instances
            let chartInstances = {};

            // Initialize Charts
            function initCharts() {
                // Destroy existing charts first
                Object.values(chartInstances).forEach((chart) => {
                    if (chart) chart.destroy();
                });
                chartInstances = {};

                // Sales Overview Chart - Use backend data
                const salesCtx = document.getElementById("salesChart");
                if (salesCtx) {
                    // Calculate monthly revenue from orders (simplified - using last 7 months)
                    const monthlyRevenue = calculateMonthlyRevenue();

                    chartInstances.salesChart = new Chart(salesCtx, {
                        type: "line",
                        data: {
                            labels: [
                                "Jan",
                                "Feb",
                                "Mar",
                                "Apr",
                                "May",
                                "Jun",
                                "Jul",
                            ],
                            datasets: [
                                {
                                    label: "Sales",
                                    data: monthlyRevenue,
                                    borderColor: "rgba(227, 30, 36, 1)",
                                    backgroundColor: "rgba(227, 30, 36, 0.1)",
                                    tension: 0.4,
                                    fill: true,
                                    pointRadius: 5,
                                    pointHoverRadius: 7,
                                    pointBackgroundColor:
                                        "rgba(227, 30, 36, 1)",
                                    pointBorderColor: "#fff",
                                    pointBorderWidth: 2,
                                },
                            ],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false,
                                },
                                tooltip: {
                                    backgroundColor: "rgba(0, 0, 0, 0.8)",
                                    padding: 12,
                                    titleColor: "#fff",
                                    bodyColor: "#fff",
                                    borderColor: "rgba(227, 30, 36, 1)",
                                    borderWidth: 1,
                                },
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: "rgba(0, 0, 0, 0.05)",
                                    },
                                    ticks: {
                                        callback: function (value) {
                                            return "à§³" + value;
                                        },
                                    },
                                },
                                x: {
                                    grid: {
                                        display: false,
                                    },
                                },
                            },
                        },
                    });
                }

                // Order Status Pie Chart
                const orderStatusCtx =
                    document.getElementById("orderStatusChart");
                if (orderStatusCtx) {
                    // Calculate order status counts from backend data
                    const completed = allOrders.filter(
                        (o) => o.status === "delivered"
                    ).length;
                    const pending = allOrders.filter(
                        (o) =>
                            o.status === "pending" || o.status === "confirmed"
                    ).length;
                    const processing = allOrders.filter(
                        (o) =>
                            o.status === "preparing" ||
                            o.status === "out_for_delivery"
                    ).length;
                    const cancelled = allOrders.filter(
                        (o) => o.status === "cancelled"
                    ).length;

                    chartInstances.orderStatusChart = new Chart(
                        orderStatusCtx,
                        {
                            type: "doughnut",
                            data: {
                                labels: [
                                    "Completed",
                                    "Pending",
                                    "Processing",
                                    "Cancelled",
                                ],
                                datasets: [
                                    {
                                        data: [
                                            completed,
                                            pending,
                                            processing,
                                            cancelled,
                                        ],
                                        backgroundColor: [
                                            "rgba(40, 167, 69, 0.8)",
                                            "rgba(255, 193, 7, 0.8)",
                                            "rgba(23, 162, 184, 0.8)",
                                            "rgba(220, 53, 69, 0.8)",
                                        ],
                                        borderColor: [
                                            "rgba(40, 167, 69, 1)",
                                            "rgba(255, 193, 7, 1)",
                                            "rgba(23, 162, 184, 1)",
                                            "rgba(220, 53, 69, 1)",
                                        ],
                                        borderWidth: 2,
                                    },
                                ],
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: "bottom",
                                        labels: {
                                            padding: 15,
                                            font: {
                                                size: 12,
                                                family: "Poppins",
                                            },
                                        },
                                    },
                                    tooltip: {
                                        backgroundColor: "rgba(0, 0, 0, 0.8)",
                                        padding: 12,
                                        borderWidth: 1,
                                    },
                                },
                            },
                        }
                    );
                }
            }

            // Initialize charts when page loads
            document.addEventListener("DOMContentLoaded", function () {
                initCharts();
            });

            // Product management functions
            function addNewProduct() {
                const name = prompt("Enter product name:");
                if (!name) return;

                const category = prompt(
                    "Enter category (Food/Beverages/Medicine/Grocery):"
                );
                if (!category) return;

                const price = prompt("Enter price in Taka (à§³):");
                if (!price || isNaN(price)) {
                    alert("Please enter a valid price");
                    return;
                }

                const stock = prompt("Enter stock quantity:");
                if (!stock || isNaN(stock)) {
                    alert("Please enter a valid stock quantity");
                    return;
                }

                // Generate new product ID
                const productId = "P" + Date.now().toString().slice(-3);

                // Add new row to products table
                const tbody = document.getElementById("products-table-body");
                if (tbody) {
                    const newRow = document.createElement("tr");
                    newRow.innerHTML = `
                        <td>#${productId}</td>
                        <td>${name}</td>
                        <td>${category}</td>
                        <td>à§³${price}</td>
                        <td>${stock}</td>
                        <td>
                            <button class="btn btn-sm" onclick="editProduct('${productId}')" style="background: #ff8c00; color: white; border: none; margin-right: 5px;">Edit</button>
                            <button
                                class="btn btn-sm"
                                onclick="deleteProduct('${productId}')"
                                style="background: var(--danger-color); color: white; border: none;"
                            >
                                Delete
                            </button>
                        </td>
                    `;
                    tbody.appendChild(newRow);

                    MoonCart.showNotification(
                        "Product added successfully!",
                        "success"
                    );
                } else {
                    alert(
                        `Product "${name}" added successfully!\nCategory: ${category}\nPrice: à§³${price}\nStock: ${stock}`
                    );
                }
            }

            // editProduct and deleteProduct functions are defined above with proper backend integration

            // General confirm modal
            let confirmCallback = null;

            function showConfirmModal(title, message, onConfirm) {
                document.getElementById("confirm-title").textContent = title;
                document.getElementById("confirm-message").textContent =
                    message;
                confirmCallback = onConfirm;
                document
                    .getElementById("confirm-modal")
                    .classList.add("active");
            }

            function closeConfirmModal() {
                document
                    .getElementById("confirm-modal")
                    .classList.remove("active");
                confirmCallback = null;
            }

            function confirmAction() {
                if (confirmCallback) {
                    confirmCallback();
                }
                closeConfirmModal();
            }

            // Filter orders function
            function filterOrders() {
                const searchTerm =
                    document
                        .getElementById("order-search-input")
                        ?.value.toLowerCase() || "";
                const statusFilter =
                    document.getElementById("status-filter")?.value || "all";
                const timeSlotFilter =
                    document.getElementById("time-slot-filter")?.value || "all";

                const filteredOrders = allOrders.filter((order) => {
                    const orderIdStr = String(
                        order.id || order.order_number || ""
                    ).toLowerCase();
                    const customerName = (
                        order.customer_name ||
                        order.customerName ||
                        ""
                    ).toLowerCase();
                    const matchesSearch =
                        orderIdStr.includes(searchTerm) ||
                        customerName.includes(searchTerm);
                    const matchesStatus =
                        statusFilter === "all" || order.status === statusFilter;
                    const matchesTimeSlot =
                        timeSlotFilter === "all" ||
                        (order.delivery_slot || order.deliverySlot) ===
                            timeSlotFilter;

                    return matchesSearch && matchesStatus && matchesTimeSlot;
                });

                displayFilteredAdminOrders(filteredOrders);
            }

            // Display filtered orders
            function displayFilteredAdminOrders(orders) {
                const container = document.getElementById("admin-orders-full2");
                if (!container) return;

                if (orders.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="text-align: center; padding: 40px; color: var(--text-light);">
                            <i class="fas fa-search" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <h3>No orders found</h3>
                            <p>Try adjusting your search or filters</p>
                        </div>
                    `;
                    return;
                }

                orders.sort(
                    (a, b) =>
                        new Date(b.created_at || b.orderDate || 0) -
                        new Date(a.created_at || a.orderDate || 0)
                );

                container.innerHTML = `
                    <div style="overflow-x: auto; width: 100%;">
                    <table style="width: 100%; border-collapse: collapse; background: white; font-size: 13px;">
                        <thead style="background: #f5f6fa;">
                            <tr>
                                <th style="padding: 12px 8px; text-align: left; white-space: nowrap; font-weight: 600;">Order ID</th>
                                <th style="padding: 12px 8px; text-align: left; white-space: nowrap; font-weight: 600;">Customer</th>
                                <th style="padding: 12px 8px; text-align: left; white-space: nowrap; font-weight: 600;">Phone</th>
                                <th style="padding: 12px 8px; text-align: left; white-space: nowrap; font-weight: 600;">Slot</th>
                                <th style="padding: 12px 8px; text-align: left; white-space: nowrap; font-weight: 600;">Date</th>
                                <th style="padding: 12px 8px; text-align: center; white-space: nowrap; font-weight: 600;">Items</th>
                                <th style="padding: 12px 8px; text-align: right; white-space: nowrap; font-weight: 600;">Total</th>
                                <th style="padding: 12px 8px; text-align: center; white-space: nowrap; font-weight: 600;">Status</th>
                                <th style="padding: 12px 8px; text-align: center; white-space: nowrap; font-weight: 600;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orders
                                .map((order) => {
                                    const orderId = String(
                                        order.id || order.order_number || ""
                                    );
                                    const orderNumber =
                                        order.order_number || orderId;
                                    return `
                                <tr style="border-bottom: 1px solid #eee;">
                                    <td style="padding: 10px 8px; white-space: nowrap; font-weight: 600;">#${String(
                                        orderNumber
                                    ).substring(0, 6)}</td>
                                    <td style="padding: 10px 8px; max-width: 120px; overflow: hidden; text-overflow: ellipsis;">${
                                        order.customer_name ||
                                        order.customerName ||
                                        "N/A"
                                    }</td>
                                    <td style="padding: 10px 8px; white-space: nowrap; font-size: 11px;">${String(
                                        order.phone || ""
                                    ).substring(0, 14)}</td>
                                    <td style="padding: 10px 8px;"><span style="background: #e3f2fd; padding: 3px 6px; border-radius: 3px; font-size: 10px; white-space: nowrap; display: inline-block;"><i class="fas fa-clock"></i> ${
                                        (
                                            order.delivery_slot ||
                                            order.deliverySlot ||
                                            ""
                                        ).split(" - ")[0]
                                    }</span></td>
                                    <td style="padding: 10px 8px; white-space: nowrap; font-size: 11px;">${formatDate(
                                        order.created_at || order.orderDate
                                    )}</td>
                                    <td style="padding: 10px 8px; text-align: center;">${
                                        order.item_count ||
                                        order.itemCount ||
                                        order.items?.length ||
                                        0
                                    }</td>
                                    <td style="padding: 10px 8px; text-align: right; font-weight: 600; color: var(--primary-color);">à§³${MoonCart.formatCurrency(
                                        parseFloat(order.total || 0)
                                    )}</td>
                                    <td style="padding: 10px 8px; text-align: center;"><span class="status-badge status-${
                                        order.status
                                    }" style="font-size: 10px; padding: 4px 8px;">${
                                        order.status
                                    }</span></td>
                                    <td style="padding: 10px 8px; text-align: center; white-space: nowrap;">
                                        <button onclick="viewAdminOrderDetails('${
                                            order.id
                                        }')" style="background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; margin: 2px;" title="View Details"><i class="fas fa-eye"></i></button>
                                        ${
                                            order.status === "pending"
                                                ? `
                                            <button onclick="acceptOrder('${order.id}')" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; margin: 2px;" title="Accept"><i class="fas fa-check"></i></button>
                                            <button onclick="showDeclineModal('${order.id}')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; margin: 2px;" title="Decline"><i class="fas fa-times"></i></button>
                                        `
                                                : ""
                                        }
                                        ${
                                            order.status === "confirmed"
                                                ? `
                                            <button onclick="showAssignModal('${order.id}')" style="background: #ff8c00; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; margin: 2px;" title="Assign"><i class="fas fa-user-plus"></i></button>
                                        `
                                                : ""
                                        }
                                    </td>
                                </tr>
                            `;
                                })
                                .join("")}
                        </tbody>
                    </table>
                    </div>
                `;
            }

            // Customer management function
            function viewCustomer(customerId) {
                const customerData = {
                    C001: {
                        name: "John Doe",
                        email: "john@example.com",
                        phone: "+880 1234 567890",
                        address: "House 45, Road 12, Bashundhara R/A",
                        orders: 5,
                        totalSpent: 8500,
                    },
                    C002: {
                        name: "Sarah Ahmed",
                        email: "sarah@example.com",
                        phone: "+880 1712 345678",
                        address: "Flat 7B, Block C, Bashundhara R/A",
                        orders: 3,
                        totalSpent: 4200,
                    },
                    C003: {
                        name: "Karim Rahman",
                        email: "karim@example.com",
                        phone: "+880 1987 654321",
                        address: "House 23, Road 8, Bashundhara R/A",
                        orders: 8,
                        totalSpent: 12800,
                    },
                    C004: {
                        name: "Fatima Khan",
                        email: "fatima@example.com",
                        phone: "+880 1556 789012",
                        address: "Flat 12C, Block F, Bashundhara R/A",
                        orders: 12,
                        totalSpent: 18500,
                    },
                    C005: {
                        name: "Ahmed Hossain",
                        email: "ahmed@example.com",
                        phone: "+880 1823 456789",
                        address: "House 78, Road 15, Bashundhara R/A",
                        orders: 6,
                        totalSpent: 9200,
                    },
                };

                const customer = customerData[customerId];
                if (customer) {
                    alert(
                        `Customer Details:\n\nName: ${customer.name}\nEmail: ${customer.email}\nPhone: ${customer.phone}\nAddress: ${customer.address}\nTotal Orders: ${customer.orders}\nTotal Spent: à§³${customer.totalSpent}`
                    );
                }
            }

            // Populate delivery assignments
            function populateDeliveryAssignments() {
                const deliveryOrders = allOrders.filter(
                    (order) =>
                        order.status === "out_for_delivery" ||
                        order.status === "confirmed"
                );
                const tbody = document.getElementById(
                    "delivery-assignments-body"
                );

                if (!tbody) return;

                if (deliveryOrders.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 30px; color: var(--text-light);">
                                No active deliveries at the moment
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = deliveryOrders
                    .map(
                        (order) => `
                            <tr>
                                <td>#${String(
                                    order.id || order.order_number || ""
                                )
                                    .substring(0, 8)
                                    .toUpperCase()}</td>
                                <td>${
                                    order.deliveryPersonName || "Not Assigned"
                                }</td>
                                <td>${
                                    order.customer_name ||
                                    order.customerName ||
                                    "N/A"
                                }</td>
                                <td>${order.address || ""}, ${
                            order.city || ""
                        }</td>
                                <td>${
                                    order.item_count || order.items?.length || 0
                                } items</td>
                                <td><span class="status-badge status-${
                                    order.status
                                }">${order.status}</span></td>
                                <td>
                                    <button class="btn btn-sm" onclick="viewAdminOrderDetails('${
                                        order.id
                                    }')" style="background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer;">View</button>
                                </td>
                            </tr>
                        `
                    )
                    .join("");
            }
        </script>
    </body>
</html>
