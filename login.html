<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Login to MoonCart" />
        <title>Login - MoonCart</title>

        <!-- Favicon -->
        <link rel="icon" type="image/svg+xml" href="assets/images/favicon.svg" />

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
            rel="stylesheet"
        />

        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />

        <!-- Stylesheets -->
        <link rel="stylesheet" href="css/main.css" />
        <link rel="stylesheet" href="css/responsive.css" />
        <style>
            /* Modern Login Page Styles */
            body {
                background: #f8f9fa;
                overflow-x: hidden;
            }

            .login-container {
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 40px 20px;
                position: relative;
                background-color: #f8f9fa;
                background-image: radial-gradient(
                        circle at 10% 20%,
                        rgba(227, 30, 36, 0.05) 0%,
                        transparent 30%
                    ),
                    radial-gradient(
                        circle at 90% 80%,
                        rgba(255, 107, 53, 0.05) 0%,
                        transparent 30%
                    );
            }

            .login-container::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e31e24' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
                opacity: 0.5;
            }

            .login-card {
                max-width: 460px;
                width: 100%;
                position: relative;
                z-index: 10;
            }

            .login-box {
                background: white;
                border-radius: 16px;
                box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
                overflow: hidden;
                position: relative;
            }

            .login-shapes {
                position: absolute;
                width: 100%;
                height: 100%;
                overflow: hidden;
                z-index: 0;
                pointer-events: none;
            }

            .shape-circle {
                position: absolute;
                border-radius: 50%;
            }

            .shape-circle-1 {
                width: 250px;
                height: 250px;
                background: linear-gradient(
                    135deg,
                    rgba(227, 30, 36, 0.05) 0%,
                    rgba(255, 107, 53, 0.05) 100%
                );
                top: -120px;
                right: -100px;
            }

            .shape-circle-2 {
                width: 200px;
                height: 200px;
                background: linear-gradient(
                    135deg,
                    rgba(255, 107, 53, 0.05) 0%,
                    rgba(227, 30, 36, 0.05) 100%
                );
                bottom: -100px;
                left: -80px;
            }

            .login-header {
                text-align: center;
                padding: 40px 40px 30px;
                position: relative;
                z-index: 2;
            }

            .login-logo {
                margin-bottom: 15px;
            }

            .login-logo img {
                height: 45px;
            }

            .login-header h2 {
                font-size: 28px;
                font-weight: 700;
                color: var(--text-dark);
                margin-bottom: 10px;
            }

            .login-header p {
                font-size: 15px;
                color: var(--text-light);
                margin-bottom: 0;
            }

            .login-body {
                padding: 0 40px 40px;
                position: relative;
                z-index: 2;
            }

            .login-form label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                font-size: 14px;
                color: var(--text-dark);
            }

            .input-group {
                margin-bottom: 24px;
                position: relative;
            }

            .input-group-icon {
                position: absolute;
                top: calc(50% + 14px);
                left: 15px;
                transform: translateY(-50%);
                color: var(--text-light);
                font-size: 16px;
            }

            .login-form .form-control {
                width: 100%;
                height: 50px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 0 15px 0 45px;
                font-family: "Poppins", sans-serif;
                font-size: 15px;
                color: var(--text-dark);
                transition: all 0.3s ease;
            }

            .login-form .form-control:focus {
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(227, 30, 36, 0.1);
                outline: none;
            }

            .form-check {
                display: flex;
                align-items: center;
                margin-bottom: 24px;
                gap: 10px;
            }

            .form-check-input {
                width: 18px;
                height: 18px;
                margin: 0;
                cursor: pointer;
            }

            .form-check-label {
                font-size: 14px;
                color: var(--text-dark);
                margin: 0;
                user-select: none;
                cursor: pointer;
                line-height: 18px;
            }

            .forgot-password {
                font-size: 14px;
                color: var(--primary-color);
                text-decoration: none;
                float: right;
                transition: all 0.3s ease;
            }

            .forgot-password:hover {
                text-decoration: underline;
                color: var(--secondary-color);
            }

            .user-type-selector {
                display: flex;
                gap: 10px;
                margin-bottom: 24px;
            }

            .user-type-option {
                flex: 1;
                position: relative;
            }

            .user-type-option input {
                position: absolute;
                opacity: 0;
                width: 0;
                height: 0;
            }

            .user-type-label {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 15px;
                background: var(--light-bg);
                border: 2px solid var(--border-color);
                border-radius: 10px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .user-type-icon {
                font-size: 28px;
                margin-bottom: 5px;
                color: var(--text-light);
                transition: all 0.3s ease;
            }

            .user-type-text {
                font-size: 14px;
                font-weight: 600;
                color: var(--text-dark);
                transition: all 0.3s ease;
            }

            .user-type-option input:checked + .user-type-label {
                border-color: var(--primary-color);
                background: rgba(227, 30, 36, 0.05);
                box-shadow: 0 5px 15px rgba(227, 30, 36, 0.1);
            }

            .user-type-option input:checked + .user-type-label .user-type-icon {
                color: var(--primary-color);
            }

            .login-button {
                width: 100%;
                padding: 15px;
                background: linear-gradient(
                    135deg,
                    var(--primary-color) 0%,
                    var(--secondary-color) 100%
                );
                border: none;
                border-radius: 8px;
                font-weight: 600;
                font-size: 16px;
                color: white;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-bottom: 24px;
                position: relative;
                overflow: hidden;
                box-shadow: 0 5px 20px rgba(227, 30, 36, 0.25);
            }

            .login-button::after {
                content: "";
                position: absolute;
                top: 0;
                left: -20%;
                width: 140%;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.2) 50%,
                    transparent 100%
                );
                transform: skewX(-30deg);
                transition: all 0.5s ease;
                opacity: 0;
            }

            .login-button:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 30px rgba(227, 30, 36, 0.35);
            }

            .login-button:hover::after {
                left: 100%;
                opacity: 1;
            }

            .social-login {
                margin-top: 30px;
                text-align: center;
            }

            .social-login-title {
                display: flex;
                align-items: center;
                margin-bottom: 20px;
            }

            .social-login-title::before,
            .social-login-title::after {
                content: "";
                flex: 1;
                height: 1px;
                background: var(--border-color);
            }

            .social-login-title span {
                padding: 0 15px;
                font-size: 14px;
                color: var(--text-light);
            }

            .social-login-buttons {
                display: flex;
                justify-content: center;
                gap: 15px;
            }

            .social-button {
                width: 48px;
                height: 48px;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 1px solid var(--border-color);
                background: white;
                color: var(--text-dark);
                font-size: 20px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .social-button:hover {
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            }

            .social-button.google:hover {
                color: #db4437;
                border-color: #db4437;
            }

            .social-button.facebook:hover {
                color: #4267b2;
                border-color: #4267b2;
            }

            .social-button.twitter:hover {
                color: #1da1f2;
                border-color: #1da1f2;
            }

            .login-footer {
                text-align: center;
                margin-top: 30px;
                font-size: 14px;
                color: var(--text-light);
            }

            .login-footer a {
                color: var(--primary-color);
                font-weight: 600;
                text-decoration: none;
                transition: all 0.3s ease;
            }

            .login-footer a:hover {
                color: var(--secondary-color);
                text-decoration: underline;
            }

            @media (max-width: 576px) {
                .login-body,
                .login-header {
                    padding-left: 25px;
                    padding-right: 25px;
                }

                .user-type-label {
                    padding: 10px;
                }

                .user-type-icon {
                    font-size: 22px;
                }

                .login-header h2 {
                    font-size: 24px;
                }
            }
        </style>
    </head>
    <body>
        <div class="login-container">
            <div class="login-card">
                <div class="login-box">
                    <div class="login-shapes">
                        <div class="shape-circle shape-circle-1"></div>
                        <div class="shape-circle shape-circle-2"></div>
                    </div>
                    <div class="login-header">
                        <div class="login-logo"></div>
                        <h2>Welcome Back!</h2>
                        <p>Please sign in to access your account</p>
                    </div>
                    <div class="login-body">
                        <form class="login-form" id="login-form">
                            <div class="user-type-selector">
                                <div class="user-type-option">
                                    <input
                                        type="radio"
                                        name="user-type"
                                        id="customer-type"
                                        value="customer"
                                        checked
                                    />
                                    <label
                                        for="customer-type"
                                        class="user-type-label"
                                    >
                                        <i
                                            class="fas fa-user user-type-icon"
                                        ></i>
                                        <span class="user-type-text"
                                            >Customer</span
                                        >
                                    </label>
                                </div>
                                <div class="user-type-option">
                                    <input
                                        type="radio"
                                        name="user-type"
                                        id="admin-type"
                                        value="admin"
                                    />
                                    <label
                                        for="admin-type"
                                        class="user-type-label"
                                    >
                                        <i
                                            class="fas fa-user-shield user-type-icon"
                                        ></i>
                                        <span class="user-type-text"
                                            >Admin</span
                                        >
                                    </label>
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="email">Email Address</label>
                                <i class="fas fa-envelope input-group-icon"></i>
                                <input
                                    type="email"
                                    class="form-control"
                                    id="email"
                                    placeholder="Enter your email"
                                    required
                                />
                            </div>

                            <div class="input-group">
                                <label for="password">Password</label>
                                <i class="fas fa-lock input-group-icon"></i>
                                <input
                                    type="password"
                                    class="form-control"
                                    id="password"
                                    placeholder="Enter your password"
                                    required
                                />
                            </div>

                            <div
                                style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    margin-bottom: 24px;
                                "
                            >
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        id="remember"
                                    />
                                    <label
                                        class="form-check-label"
                                        for="remember"
                                    >
                                        Remember me
                                    </label>
                                </div>
                                <a href="#" class="forgot-password"
                                    >Forgot Password?</a
                                >
                            </div>

                            <button
                                type="button"
                                class="login-button"
                                id="login-btn"
                                onclick="handleLogin(event)"
                            >
                                <i class="fas fa-sign-in-alt"></i>
                                <span>Sign In</span>
                            </button>

                            <div class="social-login">
                                <div class="social-login-title">
                                    <span>Or continue with</span>
                                </div>
                                <div class="social-login-buttons">
                                    <button
                                        type="button"
                                        class="social-button google"
                                    >
                                        <i class="fab fa-google"></i>
                                    </button>
                                    <button
                                        type="button"
                                        class="social-button facebook"
                                    >
                                        <i class="fab fa-facebook-f"></i>
                                    </button>
                                    <button
                                        type="button"
                                        class="social-button twitter"
                                    >
                                        <i class="fab fa-twitter"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="login-footer">
                    <p>
                        Don't have an account?
                        <a href="signup.html">Sign up now</a>
                    </p>
                    <p><a href="index.html">Back to home</a></p>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="js/main.js"></script>
        <script src="js/api.js"></script>
        <script>
            // Login handler - calls backend API for authentication
            async function handleLogin(event) {
                event.preventDefault();
                console.log("Login form submitted");

                const email = document.getElementById("email").value.trim();
                const password = document.getElementById("password").value;
                const userTypeElement = document.querySelector(
                    'input[name="user-type"]:checked'
                );

                // Validate inputs
                if (!email || !password) {
                    MoonCart.showNotification("Please enter email and password", "error");
                    return false;
                }

                if (!userTypeElement) {
                    MoonCart.showNotification("Please select a user type", "error");
                    return false;
                }

                const userType = userTypeElement.value;
                console.log(`Login attempt: ${email} as ${userType}`);

                // Show loading
                MoonCart.showLoading();

                try {
                    // Call backend API for authentication
                    const response = await MoonCartAPI.login(email, password);
                    
                    MoonCart.hideLoading();

                    if (response.success && response.user) {
                        const user = response.user;
                        
                        // Check if user role matches selected type
                        if (user.role !== userType) {
                            MoonCart.showNotification(
                                `This account is registered as ${user.role}, not ${userType}. Please select the correct user type.`,
                                "error"
                            );
                            return false;
                        }

                        // Save user to localStorage
                        localStorage.setItem("mooncart_user", JSON.stringify(user));
                        MoonCart.setCurrentUser(user);

                        MoonCart.showNotification(
                            `Welcome back, ${user.name}!`,
                            "success"
                        );

                        // Redirect based on user role
                        setTimeout(() => {
                            if (user.role === "admin") {
                                window.location.href = "admin-dashboard.html";
                            } else if (user.role === "delivery") {
                                window.location.href = "delivery-dashboard.html";
                            } else {
                                window.location.href = "customer-dashboard.html";
                            }
                        }, 1000);
                    } else {
                        MoonCart.showNotification(
                            response.message || "Login failed. Please try again.",
                            "error"
                        );
                    }
                } catch (error) {
                    MoonCart.hideLoading();
                    console.error("Login error:", error);
                    MoonCart.showNotification(
                        error.message || "Invalid email or password. Please try again.",
                        "error"
                    );
                }

                return false;
            }
        </script>
    </body>
</html>
